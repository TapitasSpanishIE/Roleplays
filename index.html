<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SEC Practice - Sr. Mart√≠n</title>
    <style>
        :root { --primary: #2c3e50; --secondary: #e74c3c; --accent: #3498db; --light-bg: #ecf0f1; --feedback: #2980b9; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background: var(--light-bg); color: #333; }
        header { background: var(--primary); color: white; padding: 15px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .author-tag { font-size: 0.8em; color: #3498db; font-weight: bold; display: block; margin-top: 5px; text-transform: uppercase; letter-spacing: 1px; }
        .selector { display: flex; overflow-x: auto; gap: 10px; padding: 12px; background: #fff; border-bottom: 1px solid #ddd; flex-shrink: 0; }
        .rp-btn { min-width: 110px; padding: 10px; background: #fff; border: 2px solid #ddd; border-radius: 8px; font-size: 13px; cursor: pointer; text-align: center; }
        .active { border-color: var(--secondary); background: #fdf2f2; font-weight: bold; color: var(--secondary); transform: scale(1.02); }
        #candidate-card { background: #fffde7; border-left: 5px solid #f1c40f; padding: 15px; margin: 10px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: relative; min-height: 80px; display: none; }
        .card-context { font-style: italic; color: #7f8c8d; margin-bottom: 10px; border-bottom: 1px solid #e1e1e1; padding-bottom: 8px; font-size: 0.85em; line-height: 1.3; }
        .current-prompt { font-weight: bold; color: #2c3e50; background: #fdf9c4; padding: 5px; border-radius: 3px; font-size: 0.95em; padding-right: 45px; line-height: 1.3; }
        .btn-feedback { position: absolute; right: 8px; bottom: 8px; background: var(--feedback); color: white; border: none; border-radius: 50%; width: 34px; height: 34px; cursor: pointer; font-weight: bold; font-size: 18px; box-shadow: 0 2px 4px rgba(0,0,0,0.2); display: none; }
        #chat { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .bubble { max-width: 85%; padding: 12px 16px; border-radius: 18px; font-size: 16px; line-height: 1.4; }
        .ex { align-self: flex-start; background: white; border: 1px solid #dee2e6; }
        .st { align-self: flex-end; background: #dcf8c6; }
        .feedback-box { font-size: 0.85em; color: var(--feedback); background: #e1f5fe; padding: 10px; border-radius: 8px; border-left: 4px solid var(--feedback); margin: 5px 0; align-self: center; width: 90%; }
        #next-trigger { display: none; margin: 10px auto; padding: 14px 24px; background: var(--secondary); color: white; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; width: 85%; font-size: 16px; }
        .input-area { background: white; padding: 15px 15px 35px 15px; display: flex; gap: 10px; border-top: 1px solid #ddd; }
        input { flex: 1; padding: 12px 18px; border-radius: 25px; border: 1px solid #ccc; font-size: 16px; outline: none; }
        .btn-send { background: var(--accent); color: white; border: none; width: 48px; height: 48px; border-radius: 50%; font-size: 20px; }
    </style>
</head>
<body>

<header>
    SEC Spanish Oral Practice
    <span class="author-tag">Created by Sr. Mart√≠n</span>
</header>

<div class="selector">
    <div class="rp-btn" id="b1" onclick="seleccionarRP(1)">üè† 1. Alojamiento</div>
    <div class="rp-btn" id="b2" onclick="seleccionarRP(2)">üíª 2. Port√°til</div>
    <div class="rp-btn" id="b3" onclick="seleccionarRP(3)">üöê 3. Camper van</div>
    <div class="rp-btn" id="b4" onclick="seleccionarRP(4)">‚ôªÔ∏è 4. Pl√°sticos</div>
    <div class="rp-btn" id="b5" onclick="seleccionarRP(5)">üöó 5. Aver√≠a</div>
</div>

<div id="candidate-card">
    <div class="card-context" id="card-context"></div>
    <div class="current-prompt" id="current-prompt"></div>
    <button class="btn-feedback" id="feedbackBtn" onclick="mostrarSugerencia()">?</button>
</div>

<div id="chat"></div>
<button id="next-trigger" onclick="proximaIntervencion()">Tap to hear Examiner ‚è©</button>

<div class="input-area">
    <input type="text" id="userInput" placeholder="Selecciona un escenario..." disabled>
    <button class="btn-send" id="sendBtn" onclick="enviarRespuesta()" disabled>‚ñ∂Ô∏è</button>
</div>

<script>
    let rpActual = null;
    let pasoActual = 0;
    let speaking = false;

    const database = {
        1: {
            context: "Vas de ERASMUS a la Universidad de Extremadura en C√°ceres. Necesitas alojamiento y llamas por tel√©fono a la universidad.",
            prompts: [
                "1. Say you'll be on ERASMUS next year. You don't know anybody in Caceres and ask for advice about accommodation.",
                "2. Say you'd prefer to live near the university because last year you lived in the outskirts of Dublin and really didn't like it.",
                "3. Say you spent too much time travelling. If you could spend that time studying, you'd get good grades.",
                "4. Say the climate is much better than Ireland. You'll consider all areas even if you prefer the center.",
                "5. Answer the examiner's question.",
                "Fin de la prueba."
            ],
            dialogs: [
                "¬°Hola, d√≠game!",
                "¬øEn qu√© parte de la ciudad querr√≠as vivir?",
                "¬øPor qu√©?",
                "Tienes raz√≥n. Pero sabes que C√°ceres es una ciudad muy peque√±a y se puede andar desde las afueras a la Plaza Mayor en media hora.",
                ["¬øHas estado alguna vez en Espa√±a?", "¬øPrefieres residencia o piso compartido?", "¬øTe gusta vivir en Espa√±a?"],
                "¬°Mucha suerte en C√°ceres!"
            ],
            sugerencias: [
                "Hola, voy a ir de ERASMUS el pr√≥ximo a√±o acad√©mico. No conozco a nadie en C√°ceres, ¬øpodr√≠a darme alg√∫n consejo sobre el alojamiento?",
                "Preferir√≠a vivir cerca de la universidad porque el a√±o pasado viv√≠ en las afueras de Dubl√≠n y no me gust√≥ nada.",
                "Es que pasaba demasiado tiempo viajando. Si pudiera dedicar ese tiempo a estudiar, sacar√≠a mejores notas.",
                "Bueno, el clima es mucho mejor que en Irlanda, as√≠ que considerar√© todas las zonas aunque preferir√≠a el centro.",
                "(Responde libremente seg√∫n la pregunta)",
                ""
            ]
        },
        2: {
            context: "Est√°s en √Åvila y se te ha roto el port√°til. Lo llevas a arreglar.",
            prompts: [
                "1. Screen broken. Essay due tomorrow (only copy).",
                "2. Slipped and fell while running for the bus.",
                "3. Cuesta 200‚Ç¨? You saw same model for 300‚Ç¨ in window.",
                "4. Buy it if they copy files + free bag.",
                "5. Answer question.",
                "Fin."
            ],
            dialogs: ["¬°Hola! ¬øEn qu√© puedo ayudarte?", "¬øQu√© le pas√≥?", "Necesitas una pantalla nueva. Son 200 euros.", "Hay una oferta. ¬øQuieres comprarlo?", ["¬øUsas mucho el ordenador?", "¬øQu√© marca es?"], "Examen finalizado."],
            sugerencias: [
                "Hola, se me ha ca√≠do el port√°til y la pantalla est√° rota. Tengo un ensayo para ma√±ana y la √∫nica copia est√° aqu√≠.",
                "Es que llegaba tarde al autob√∫s, me resbal√© y el port√°til se cay√≥ al suelo.",
                "Qu√© bien que se pueda arreglar, pero he visto el mismo modelo en el escaparate por 300 euros.",
                "Lo comprar√© si pueden copiar mis archivos y me dan un malet√≠n gratis.",
                "Lo uso todos los d√≠as para mis estudios y para ver series.",
                ""
            ]
        },
        3: {
            context: "Alquiler de autocaravana para julio.",
            prompts: [
                "1. Irish student, hire camper for 2 weeks in July.",
                "2. Mother driving (no licence yet).",
                "3. Driven on right 20 years. Careful driver.",
                "4. Travel through Castilla-La Mancha (Cervantes).",
                "5. Answer question.",
                "Fin."
            ],
            dialogs: ["¬°D√≠game!", "Hace falta ser mayor de 25 a√±os.", "Perfecto, ella puede conducir.", "¬øTen√©is itinerario?", ["¬øTe gusta acampar?", "¬øMar o monta√±a?"], "¬°Buen viaje!"],
            sugerencias: [
                "Hola, soy un estudiante de Irlanda y estoy interesado en alquilar una autocaravana dos semanas en julio.",
                "Mi madre conducir√° porque yo no tengo carn√© todav√≠a. Estoy recibiendo clases.",
                "Ella ha conducido por la derecha en Europa durante 20 a√±os y es una conductora muy cuidadosa.",
                "Esperamos viajar por Castilla-La Mancha para ver la tierra de Cervantes.",
                "Me encanta acampar porque prefiero estar al aire libre.",
                ""
            ]
        },
        4: {
            context: "Noticias sobre pl√°sticos de un solo uso.",
            prompts: [
                "1. EU ban plastics.",
                "2. Essential for waters. Serious problem in oceans.",
                "3. Recycled paper / biodegradables.",
                "4. Citizens responsibility (cycle/walk).",
                "5. Answer question.",
                "Fin."
            ],
            dialogs: ["¬øPor qu√© est√°s tan contento?", "¬øEs importante prohibir pl√°sticos?", "¬øPodemos hacer algo m√°s?", "¬øY ya est√°?", ["¬øRecicl√°is en tu instituto?", "¬øQu√© opinas del clima?"], "¬°Muy bien!"],
            sugerencias: [
                "El Parlamento Europeo ha acordado prohibir los pl√°sticos de un solo uso como pajitas y cubiertos.",
                "Es esencial y ser√° bueno para el agua. El pl√°stico es un problema muy serio en r√≠os y oc√©anos.",
                "Podemos usar papel reciclado o materiales biodegradables en lugar de pl√°stico.",
                "No, los ciudadanos necesitan ser m√°s responsables. Podr√≠amos ir en bici o caminar m√°s.",
                "S√≠, en mi colegio tenemos varios contenedores para reciclar todo.",
                ""
            ]
        },
        5: {
            context: "Aver√≠a de coche en la AP-6.",
            prompts: [
                "1. Broken down on AP-6.",
                "2. Exit 156. Ask for mechanic.",
                "3. Replacement car (Lugo airport).",
                "4. Red SEAT Ibiza (from aunt).",
                "5. Answer question.",
                "Fin."
            ],
            dialogs: ["Buenas tardes, seguros.", "¬øAlguna se√±al cerca?", "Voy a enviar ayuda.", "¬øC√≥mo es su coche?", ["¬øSabe cambiar una rueda?", "¬øHa esperado mucho?"], "Llegamos pronto."],
            sugerencias: [
                "Hola, mi coche se ha averiado en la AP-6. Pas√© el peaje hace media hora.",
                "Veo la se√±al de salida 156. ¬øPodr√≠a enviarme un mec√°nico o una gr√∫a? Es serio.",
                "¬øPodr√≠a darme un coche de sustituci√≥n para ir a Lugo? Tengo que recoger a mis padres.",
                "Es un SEAT Ibiza rojo, matr√≠cula 4620 CFK. Se lo compr√© a mi t√≠a.",
                "No, no s√© cambiarla, es muy dif√≠cil y peligroso.",
                ""
            ]
        }
    };

    function setInputEnabled(enabled) {
        document.getElementById('userInput').disabled = !enabled;
        document.getElementById('sendBtn').disabled = !enabled;
        document.getElementById('feedbackBtn').style.display = enabled ? "block" : "none";
        document.getElementById('userInput').placeholder = enabled ? "Escribe aqu√≠..." : "Esperando...";
    }

    function seleccionarRP(id) {
        rpActual = id; pasoActual = 0; speaking = false;
        window.speechSynthesis.cancel();
        document.querySelectorAll('.rp-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('b' + id).classList.add('active');
        document.getElementById('candidate-card').style.display = "block";
        document.getElementById('card-context').innerHTML = database[id].context;
        document.getElementById('current-prompt').innerHTML = "Pulsa el BOT√ìN ROJO para o√≠r al examinador.";
        document.getElementById('chat').innerHTML = "";
        document.getElementById('next-trigger').style.display = "block";
        setInputEnabled(false);
    }

    function mostrarSugerencia() {
        const sug = database[rpActual].sugerencias[pasoActual];
        if(sug) {
            document.getElementById('chat').innerHTML += `<div class="feedback-box">üí° <b>Model Answer:</b> ${sug}</div>`;
            document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
        }
    }

    function enviarRespuesta() {
        if (!rpActual || speaking) return;
        const input = document.getElementById('userInput');
        const texto = input.value.trim();
        if (!texto) return;

        window.speechSynthesis.speak(new SpeechSynthesisUtterance("")); 
        document.getElementById('chat').innerHTML += `<div class="bubble st">${texto}</div>`;
        input.value = "";
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
        
        setInputEnabled(false);
        pasoActual++; 
        setTimeout(() => { document.getElementById('next-trigger').style.display = "block"; }, 400);
    }

    function proximaIntervencion() {
        if (!rpActual || speaking) return;
        document.getElementById('next-trigger').style.display = "none";
        speaking = true;

        let t = database[rpActual].dialogs[pasoActual];
        let audioPath = "";

        if (Array.isArray(t)) {
            let index = Math.floor(Math.random() * t.length);
            t = t[index];
            audioPath = `rp${rpActual}_5${['a','b','c'][index]}.mp3`;
        } else {
            audioPath = `rp${rpActual}_${pasoActual + 1}.mp3`;
        }

        document.getElementById('chat').innerHTML += `<div class="bubble ex"><b>Ex:</b> ${t}</div>`;
        document.getElementById('current-prompt').innerHTML = `<b>Prompt:</b> ${database[rpActual].prompts[pasoActual]}`;
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;

        const finalizarTurno = () => {
            speaking = false;
            if (pasoActual < database[rpActual].dialogs.length - 1) setInputEnabled(true);
        };

        const audio = new Audio(audioPath);
        audio.play().then(() => { audio.onended = finalizarTurno; }).catch(() => { hablarRobot(t, finalizarTurno); });
    }

    function hablarRobot(texto, cb) {
        window.speechSynthesis.cancel();
        const m = new SpeechSynthesisUtterance(texto);
        m.lang = 'es-ES'; m.rate = 0.85; m.onend = cb;
        window.speechSynthesis.speak(m);
    }
</script>
</body>
</html>
