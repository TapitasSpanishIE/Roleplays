<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SEC Practice - Sr. Mart√≠n</title>
    <style>
        :root { --primary: #2c3e50; --secondary: #e74c3c; --accent: #3498db; --light-bg: #ecf0f1; --feedback: #2980b9; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background: var(--light-bg); color: #333; overflow: hidden; }
        
        /* Modal de Bienvenida */
        #modal-instrucciones { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); display:flex; align-items:center; justify-content:center; z-index:9999; padding: 20px; box-sizing: border-box; }
        .modal-content { background: white; padding: 25px; border-radius: 15px; max-width: 500px; width: 100%; text-align: left; box-shadow: 0 5px 30px rgba(0,0,0,0.5); }
        .modal-content h2 { color: var(--secondary); margin-top: 0; text-align: center; font-size: 1.5em; }
        .welcome-msg { font-style: italic; color: var(--primary); margin-bottom: 15px; border-bottom: 2px solid #f1f1f1; padding-bottom: 10px; text-align: center; line-height: 1.4; }
        .modal-content p { font-size: 0.95em; line-height: 1.5; margin: 10px 0; }
        .btn-close { display: block; width: 100%; background: var(--primary); color: white; padding: 15px; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px; font-weight: bold; font-size: 1.1em; }

        header { background: var(--primary); color: white; padding: 12px; text-align: center; flex-shrink: 0; }
        .author-tag { font-size: 0.85em; color: #3498db; font-weight: bold; display: block; margin-top: 4px; }
        
        .selector { display: flex; overflow-x: auto; gap: 10px; padding: 12px; background: #fff; border-bottom: 1px solid #ddd; flex-shrink: 0; -webkit-overflow-scrolling: touch; }
        .rp-btn { min-width: 120px; padding: 10px; background: #fff; border: 2px solid #ddd; border-radius: 8px; font-size: 13px; cursor: pointer; white-space: nowrap; }
        .active { border-color: var(--secondary); background: #fdf2f2; font-weight: bold; color: var(--secondary); }
        
        #candidate-card { background: #fffde7; border-left: 5px solid #f1c40f; padding: 15px; margin: 10px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); relative; min-height: 90px; flex-shrink: 0; display: none; position: relative; }
        .card-context { font-style: italic; color: #7f8c8d; margin-bottom: 8px; font-size: 0.85em; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .current-prompt { font-weight: bold; color: #2c3e50; font-size: 0.95em; padding-right: 50px; line-height: 1.4; }
        
        .btn-feedback { position: absolute; right: 10px; bottom: 10px; background: var(--feedback); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-weight: bold; font-size: 22px; display: none; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 100; }

        #chat { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 12px; background: #f9f9f9; }
        .bubble { max-width: 85%; padding: 12px 16px; border-radius: 18px; font-size: 16px; line-height: 1.4; position: relative; }
        .ex { align-self: flex-start; background: white; border: 1px solid #dee2e6; border-bottom-left-radius: 2px; }
        .st { align-self: flex-end; background: #dcf8c6; border-bottom-right-radius: 2px; color: #000; }
        .feedback-box { font-size: 0.9em; color: var(--feedback); background: #e1f5fe; padding: 12px; border-radius: 10px; border-left: 5px solid var(--feedback); margin: 5px 0; align-self: center; width: 90%; }
        
        #next-trigger { display: none; margin: 10px auto; padding: 15px; background: var(--secondary); color: white; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; width: 85%; font-size: 16px; flex-shrink: 0; box-shadow: 0 4px 10px rgba(231,76,60,0.3); }

        .input-area { background: white; padding: 15px 15px 30px 15px; display: flex; gap: 10px; border-top: 1px solid #ddd; flex-shrink: 0; }
        input { flex: 1; padding: 14px 20px; border-radius: 30px; border: 2px solid #eee; font-size: 16px; outline: none; background: #fff !important; color: #000 !important; }
        input:focus { border-color: var(--accent); }
        .btn-send { background: var(--accent); color: white; border: none; width: 50px; height: 50px; border-radius: 50%; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .btn-send:disabled { background: #ccc; }
    </style>
</head>
<body>

<div id="modal-instrucciones">
    <div class="modal-content">
        <h2>¬°Bienvenidos a TapitasSpanishIE!</h2>
        <p class="welcome-msg">I hope you find this Role Play simulator very useful for your Leaving Cert preparation. ¬°Mucho √°nimo!</p>
        
        <p><b>1. Choose:</b> Select a scenario from the top menu.</p>
        <p><b>2. Listen:</b> Tap the red <b>‚è© button</b> to hear the Examiner.</p>
        <p><b>3. Your Turn:</b> Read the yellow card. Tap the üé§ on your keyboard to speak (or type). <b>Crucial:</b> You must press the blue <b>‚ñ∂Ô∏è button</b> to send your answer and continue.</p>
        <p><b>4. Support:</b> Stuck? Tap the blue <b>?</b> button for a model answer.</p>
        
        <button class="btn-close" onclick="document.getElementById('modal-instrucciones').style.display='none'">START PRACTICE</button>
    </div>
</div>

<header>
    SEC Spanish Oral Practice
    <span class="author-tag">Created by Sr. Mart√≠n</span>
</header>

<div class="selector">
    <div class="rp-btn" id="b1" onclick="seleccionarRP(1)">üè† 1. Alojamiento</div>
    <div class="rp-btn" id="b2" onclick="seleccionarRP(2)">üíª 2. Port√°til</div>
    <div class="rp-btn" id="b3" onclick="seleccionarRP(3)">üöê 3. Camper van</div>
    <div class="rp-btn" id="b4" onclick="seleccionarRP(4)">‚ôªÔ∏è 4. Pl√°sticos</div>
    <div class="rp-btn" id="b5" onclick="seleccionarRP(5)">üöó 5. Aver√≠a</div>
</div>

<div id="candidate-card">
    <div class="card-context" id="card-context"></div>
    <div class="current-prompt" id="current-prompt"></div>
    <button class="btn-feedback" id="feedbackBtn" onclick="mostrarSugerencia()">?</button>
</div>

<div id="chat"></div>
<button id="next-trigger" onclick="proximaIntervencion()">Tap to hear Examiner ‚è©</button>

<div class="input-area">
    <input type="text" id="userInput" placeholder="Select a scenario..." disabled>
    <button class="btn-send" id="sendBtn" onclick="enviarRespuesta()" disabled>‚ñ∂Ô∏è</button>
</div>

<script>
    let rpActual = null;
    let pasoActual = 0;
    let speaking = false;

    const database = {
        1: {
            context: "ERASMUS en C√°ceres. Llamas a la universidad por alojamiento.",
            prompts: [
                "1. Say you'll be on ERASMUS next year. Ask for advice about accommodation.",
                "2. Say you'd prefer to live near the university (Dublin outskirts experience).",
                "3. Travelling took too much time. If you could study that time, you'd get good grades.",
                "4. Climate is better than Ireland. Consider all areas but prefer center.",
                "5. Answer the examiner's question.",
                "Role Play finished."
            ],
            dialogs: [
                "¬°Hola, d√≠game!",
                "¬øEn qu√© parte de la ciudad querr√≠as vivir?",
                "¬øPor qu√©?",
                "Tienes raz√≥n. Pero sabes que C√°ceres es una ciudad muy peque√±a y se puede andar desde las afueras a la Plaza Mayor en media hora.",
                ["¬øHas estado alguna vez en Espa√±a?", "¬øPrefieres residencia o piso?", "¬øTe gusta Espa√±a?"],
                "¬°Hemos terminado!"
            ],
            sugerencias: [
                "Hola, voy a ir de ERASMUS el pr√≥ximo a√±o acad√©mico. No conozco a nadie en C√°ceres, ¬øpodr√≠a darme alg√∫n consejo sobre el alojamiento?",
                "Preferir√≠a vivir cerca de la universidad porque el a√±o pasado viv√≠ en las afueras de Dubl√≠n y no me gust√≥ nada.",
                "Es que pasaba demasiado tiempo viajando. Si pudiera dedicar ese tiempo a estudiar, sacar√≠a mejores notas.",
                "Bueno, el clima es mucho mejor que en Irlanda, as√≠ que considerar√© todas las zonas aunque preferir√≠a el centro.",
                "(Respuesta libre seg√∫n la pregunta)",
                ""
            ]
        },
        2: {
            context: "Port√°til roto en √Åvila.",
            prompts: ["1. Screen broken. Essay due tomorrow.","2. Slipped and fell running for bus.","3. Cuesta 200‚Ç¨? Saw same for 300‚Ç¨ in window.","4. Buy if files copied + free bag.","5. Answer question.","Fin."],
            dialogs: ["¬°Hola! ¬øQu√© pasa?","¬øC√≥mo se rompi√≥?","Reparar cuesta 200 euros.","Esta semana hay oferta. ¬øLo compras? ",["¬øQu√© marca es?", "¬øUsas mucho el PC?"],"Fin."],
            sugerencias: ["Hola, se me ha ca√≠do el port√°til y la pantalla est√° rota. Tengo un ensayo para ma√±ana y la √∫nica copia est√° aqu√≠.","Llegaba tarde al autob√∫s, me resbal√© y el port√°til se cay√≥ al suelo.","Qu√© bien que se pueda arreglar, pero he visto el mismo modelo en el escaparate por 300 euros.","Lo comprar√© si pueden copiar mis archivos y me dan un malet√≠n gratis.","Lo uso todos los d√≠as para clase.", ""]
        },
        3: {
            context: "Alquiler de Camper Van.",
            prompts: ["1. Irish student, hire for July.","2. Mother driving.","3. Driven on right 20 years. Careful.","4. Castilla-La Mancha (Cervantes).","5. Answer.","Fin."],
            dialogs: ["¬°D√≠game!","Debes ser mayor de 25 a√±os.","Ah, entonces no hay problema.","¬øTen√©is una ruta? ",["¬øTe gusta viajar as√≠?"],"Fin."],
            sugerencias: ["Hola, soy un estudiante de Irlanda y quiero alquilar una autocaravana dos semanas en julio.","Mi madre conducir√° porque yo no tengo carn√© todav√≠a.","Ella ha conducido por la derecha 20 a√±os en Europa y es muy cuidadosa.","Esperamos viajar por Castilla-La Mancha para ver la tierra de Cervantes.","S√≠, me gusta la libertad de dormir donde quiera.", ""]
        },
        4: {
            context: "Problema de pl√°sticos.",
            prompts: ["1. EU ban plastics.","2. Essential for waters. Serious problem in oceans.","3. Recycled paper / biodegradables.","4. Citizens responsibility (cycle/walk).","5. Answer.","Fin."],
            dialogs: ["¬øPor qu√© est√°s contento?","¬øEs buena idea prohibirlos?","¬øHay alternativas?","¬øQu√© m√°s podemos hacer?",["¬øReciclas en casa?"],"Fin."],
            sugerencias: ["El Parlamento Europeo ha acordado prohibir los pl√°sticos de un solo uso.","Es esencial para el agua. El pl√°stico es un problema serio en los oc√©anos.","Podemos usar papel reciclado o materiales biodegradables.","Los ciudadanos deben ser responsables e ir en bici o caminar m√°s.","S√≠, separo el pl√°stico, el vidrio y el papel.", ""]
        },
        5: {
            context: "Aver√≠a coche AP-6.",
            prompts: ["1. Broken down AP-6.","2. Exit 156. Ask for mechanic.","3. Replacement car (Lugo).","4. Red SEAT Ibiza (aunt).","5. Answer.","Fin."],
            dialogs: ["Hola, seguros.","¬øVes alguna se√±al?","Enviamos una gr√∫a.","¬øC√≥mo es el coche?",["¬øSabes cambiar ruedas?"],"Fin."],
            sugerencias: ["Mi coche se ha averiado en la AP-6. Pas√© el peaje hace media hora.","Veo la se√±al 156. ¬øPuede enviarme un mec√°nico o una gr√∫a? Es serio.","¬øMe pueden dar un coche de sustituci√≥n? Tengo que recoger a mis padres en Lugo.","Es un SEAT Ibiza rojo que le compr√© a mi t√≠a.","No, es muy dif√≠cil y no tengo herramientas.", ""]
        }
    };

    function setInputEnabled(enabled) {
        const input = document.getElementById('userInput');
        const btn = document.getElementById('sendBtn');
        input.disabled = !enabled;
        btn.disabled = !enabled;
        document.getElementById('feedbackBtn').style.display = enabled ? "block" : "none";
        input.placeholder = enabled ? "Escribe o usa el micro üé§" : "Esperando...";
        if(enabled) input.focus();
    }

    function seleccionarRP(id) {
        rpActual = id; pasoActual = 0; speaking = false;
        window.speechSynthesis.cancel();
        document.querySelectorAll('.rp-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('b' + id).classList.add('active');
        document.getElementById('candidate-card').style.display = "block";
        document.getElementById('card-context').innerHTML = database[id].context;
        document.getElementById('current-prompt').innerHTML = "Tap the RED BUTTON to begin.";
        document.getElementById('chat').innerHTML = "";
        document.getElementById('next-trigger').style.display = "block";
        setInputEnabled(false);
    }

    function mostrarSugerencia() {
        if(!rpActual) return;
        const sug = database[rpActual].sugerencias[pasoActual];
        if(sug) {
            const fb = document.createElement('div');
            fb.className = 'feedback-box';
            fb.innerHTML = `üí° <b>Model:</b> ${sug}`;
            document.getElementById('chat').appendChild(fb);
            document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
        }
    }

    function enviarRespuesta() {
        if (!rpActual || speaking) return;
        const input = document.getElementById('userInput');
        const texto = input.value.trim();
        if (!texto) return;

        document.getElementById('chat').innerHTML += `<div class="bubble st">${texto}</div>`;
        input.value = "";
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
        
        setInputEnabled(false);
        pasoActual++; 
        setTimeout(() => { document.getElementById('next-trigger').style.display = "block"; }, 300);
    }

    function proximaIntervencion() {
        if (!rpActual || speaking) return;
        document.getElementById('next-trigger').style.display = "none";
        speaking = true;

        let t = database[rpActual].dialogs[pasoActual];
        let audioPath = "";

        if (Array.isArray(t)) {
            let idx = Math.floor(Math.random() * t.length);
            t = t[idx];
            audioPath = `rp${rpActual}_5${['a','b','c'][idx]}.mp3`;
        } else {
            audioPath = `rp${rpActual}_${pasoActual + 1}.mp3`;
        }

        document.getElementById('chat').innerHTML += `<div class="bubble ex"><b>Ex:</b> ${t}</div>`;
        document.getElementById('current-prompt').innerHTML = `<b>Prompt:</b> ${database[rpActual].prompts[pasoActual]}`;
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;

        const finalizarTurno = () => {
            speaking = false;
            if (pasoActual < database[rpActual].dialogs.length - 1) setInputEnabled(true);
        };

        const audio = new Audio(audioPath);
        audio.play().then(() => { audio.onended = finalizarTurno; }).catch(() => { hablarRobot(t, finalizarTurno); });
    }

    function hablarRobot(texto, cb) {
        window.speechSynthesis.cancel();
        const m = new SpeechSynthesisUtterance(texto);
        m.lang = 'es-ES'; m.rate = 0.9; m.onend = cb;
        window.speechSynthesis.speak(m);
    }
</script>
</body>
</html>
