<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SEC Practice - Sr. Mart√≠n</title>
    <style>
        :root { 
            --primary: #2c3e50; 
            --secondary: #e74c3c; 
            --accent: #3498db; 
            --light-bg: #ecf0f1; 
            --feedback: #2980b9; 
        }
        html, body { 
            height: 100%; 
            margin: 0; 
            padding: 0; 
            overflow: hidden; 
            background: var(--light-bg); 
        }
        body { 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            display: flex; 
            flex-direction: column; 
        }
        
        /* Modal de Inicio */
        #modal-instrucciones { 
            position: fixed; 
            top:0; left:0; 
            width:100%; height:100%; 
            background:rgba(0,0,0,0.9); 
            display:flex; 
            align-items:center; 
            justify-content:center; 
            z-index:9999; 
            padding: 20px; 
            box-sizing: border-box; 
        }
        .modal-content { 
            background: white; 
            padding: 25px; 
            border-radius: 15px; 
            max-width: 500px; 
            width: 100%; 
            text-align: left; 
        }
        .btn-close { 
            display: block; 
            width: 100%; 
            background: var(--primary); 
            color: white; 
            padding: 18px; 
            border: none; 
            border-radius: 10px; 
            cursor: pointer; 
            margin-top: 20px; 
            font-weight: bold; 
            font-size: 1.1em; 
        }

        header { 
            background: var(--primary); 
            color: white; 
            padding: 10px; 
            text-align: center; 
            flex-shrink: 0; 
        }
        .author-tag { 
            font-size: 0.85em; 
            color: #3498db; 
            font-weight: bold; 
            display: block; 
        }
        
        /* Selector de Role Plays */
        .selector { 
            display: flex; 
            overflow-x: auto; 
            gap: 10px; 
            padding: 12px; 
            background: #fff; 
            border-bottom: 1px solid #ddd; 
            flex-shrink: 0; 
            -webkit-overflow-scrolling: touch; 
        }
        .rp-btn { 
            min-width: 130px; 
            padding: 12px; 
            background: #fff; 
            border: 2px solid #ddd; 
            border-radius: 10px; 
            font-size: 14px; 
            cursor: pointer; 
            white-space: nowrap; 
        }
        .active { 
            border-color: var(--secondary); 
            background: #fdf2f2; 
            font-weight: bold; 
            color: var(--secondary); 
        }
        
        /* Tarjeta del Candidato (Prompts) */
        #candidate-card { 
            background: #fffde7; 
            border-left: 5px solid #f1c40f; 
            padding: 15px; 
            margin: 10px; 
            border-radius: 8px; 
            flex-shrink: 0; 
            position: relative; 
            min-height: 80px; 
        }
        .card-context { 
            font-style: italic; 
            color: #7f8c8d; 
            margin-bottom: 8px; 
            font-size: 0.85em; 
            border-bottom: 1px solid #eee; 
            padding-bottom: 5px; 
        }
        .current-prompt { 
            font-weight: bold; 
            color: #2c3e50; 
            font-size: 0.95em; 
            padding-right: 50px; 
            line-height: 1.4; 
        }
        
        .btn-feedback { 
            position: absolute; 
            right: 10px; 
            top: 50%; 
            transform: translateY(-50%); 
            background: var(--feedback); 
            color: white; 
            border: none; 
            border-radius: 50%; 
            width: 44px; 
            height: 44px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 24px; 
            display: none; 
            z-index: 100; 
        }

        /* Chat */
        #chat { 
            flex-grow: 1; 
            overflow-y: auto; 
            padding: 15px; 
            display: flex; 
            flex-direction: column; 
            gap: 12px; 
            background: #f9f9f9; 
            -webkit-overflow-scrolling: touch; 
        }
        .bubble { 
            max-width: 85%; 
            padding: 12px 16px; 
            border-radius: 18px; 
            font-size: 16px; 
            line-height: 1.4; 
            position: relative; 
        }
        .ex { 
            align-self: flex-start; 
            background: white; 
            border: 1px solid #dee2e6; 
            cursor: pointer; 
        }
        .ex::after { 
            content: ' üîä'; 
            font-size: 0.7em; 
            opacity: 0.4; 
        }
        .st { 
            align-self: flex-end; 
            background: #dcf8c6; 
            color: #000; 
            border: 1px solid #c5e1a5; 
        }
        .feedback-box { 
            font-size: 0.9em; 
            color: var(--feedback); 
            background: #e1f5fe; 
            padding: 12px; 
            border-radius: 10px; 
            border-left: 5px solid var(--feedback); 
            margin: 5px 0; 
            align-self: center; 
            width: 90%; 
        }
        
        /* Bot√≥n de Siguiente */
        #next-trigger { 
            display: none; 
            margin: 10px auto; 
            padding: 18px; 
            background: var(--secondary); 
            color: white; 
            border: none; 
            border-radius: 50px; 
            font-weight: bold; 
            cursor: pointer; 
            width: 85%; 
            font-size: 16px; 
            flex-shrink: 0; 
        }

        /* √Årea de entrada */
        .input-area { 
            background: white; 
            padding: 10px 10px 30px 10px; 
            display: flex; 
            gap: 10px; 
            border-top: 1px solid #ddd; 
            flex-shrink: 0; 
            align-items: center; 
        }
        input { 
            flex: 1; 
            padding: 14px 20px; 
            border-radius: 30px; 
            border: 2px solid #eee; 
            font-size: 16px; 
            outline: none; 
            -webkit-appearance: none; 
        }
        .btn-send { 
            background: var(--accent); 
            color: white; 
            border: none; 
            width: 50px; 
            height: 50px; 
            border-radius: 50%; 
            font-size: 20px; 
            cursor: pointer; 
            flex-shrink: 0; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
    </style>
</head>
<body>

<div id="modal-instrucciones">
    <div class="modal-content">
        <h2 style="text-align:center">SEC Oral Practice</h2>
        <p><b>1. Selecciona Escenario</b> arriba.<br><b>2. Bot√≥n Rojo:</b> Escucha al examinador.<br><b>3. Bot√≥n "?" azul:</b> Ayuda con la respuesta.<br><b>4. Burbuja blanca:</b> Toca para repetir audio.</p>
        <button class="btn-close" onclick="startApp()">COMENZAR</button>
    </div>
</div>

<header>SEC Spanish Oral Practice <span class="author-tag">Created by Sr. Mart√≠n</span></header>

<div class="selector">
    <div class="rp-btn" onclick="seleccionarRP(1, this)">üè† 1. Alojamiento</div>
    <div class="rp-btn" onclick="seleccionarRP(2, this)">üíª 2. Port√°til</div>
    <div class="rp-btn" onclick="seleccionarRP(3, this)">üöê 3. Camper van</div>
    <div class="rp-btn" onclick="seleccionarRP(4, this)">‚ôªÔ∏è 4. Pl√°sticos</div>
    <div class="rp-btn" onclick="seleccionarRP(5, this)">üöó 5. Aver√≠a</div>
</div>

<div id="candidate-card">
    <div class="card-context" id="card-context"></div>
    <div class="current-prompt" id="current-prompt">Selecciona un Role Play para empezar.</div>
    <button class="btn-feedback" id="feedbackBtn" onclick="mostrarSugerencia()">?</button>
</div>

<div id="chat"></div>
<button id="next-trigger" onclick="proximaIntervencion()">Toca para o√≠r al examinador ‚è©</button>

<div class="input-area">
    <input type="text" id="userInput" placeholder="Esperando..." disabled>
    <button class="btn-send" id="sendBtn" onclick="enviarRespuesta()" disabled>‚ñ∂Ô∏è</button>
</div>

<script>
    let rpActual = null; 
    let pasoActual = 0; 
    let speaking = false;

    const database = {
        1: {
            context: "ERASMUS en C√°ceres. Llamas por alojamiento.",
            prompts: [
                "1. ERASMUS next year. Ask for advice.",
                "2. Near uni (Dublin outskirts experience).",
                "3. Travelling too long. Study = good grades.",
                "4. Better climate. All areas ok but prefer center.",
                "5. Respond to the surprise question.",
                "Finished."
            ],
            dialogs: [
                "¬°Hola, d√≠game!",
                "¬øEn qu√© parte de la ciudad querr√≠as vivir?",
                "¬øPor qu√©?",
                "Tienes raz√≥n. Pero sabes que C√°ceres es una ciudad muy peque√±a... ",
                ["¬øHas estado alguna vez en Espa√±a?", "¬øQu√© es lo que m√°s te gusta de Espa√±a?", "¬øPor qu√© estudiar en Espa√±a?"],
                "¬°Mucha suerte en tu a√±o Erasmus!"
            ],
            sugerencias: [
                "Hola, voy de ERASMUS el a√±o que viene. ¬øPodr√≠a darme alg√∫n consejo sobre el alojamiento?",
                "Preferir√≠a vivir cerca de la universidad porque el a√±o pasado viv√≠ en las afueras de Dubl√≠n y no me gust√≥.",
                "Pasaba demasiado tiempo viajando. Si pudiera dedicar ese tiempo a estudiar, sacar√≠a mejores notas.",
                "Bueno, el clima es mucho mejor que en Irlanda, as√≠ que considerar√© todas las zonas aunque preferir√≠a el centro.",
                "(Respuesta libre...)",
                ""
            ]
        },
        2: { 
            context: "You are in √Åvila and your laptop is broken.", 
            prompts: [
                "1. Laptop fell and screen is broken. Essay due tomorrow.",
                "2. Late for bus, slipped, only noticed when got up.",
                "3. Good it can be fixed. Same model in window costs 300‚Ç¨.",
                "4. Will buy if files are copied and get a free bag.",
                "5. Respond to the surprise question.",
                "Fin."
            ], 
            dialogs: [
                "¬°Hola! ¬øEn qu√© puedo ayudarte?",
                "Vamos a ver. ¬øQu√© te pas√≥?",
                "Vas a necesitar una nueva pantalla que cuesta doscientos euros.",
                "S√≠, hay una oferta especial esta semana. ¬øQuieres comprarlo?",
                ["¬øDe qu√© marca es tu ordenador?","¬øPara qu√© usas el ordenador normalmente?","¬øDe qu√© color te gustar√≠a la funda del ordenador?"],
                "¬°Hemos terminado! Gracias"
            ], 
            sugerencias: [
                "Se me cay√≥ el port√°til y la pantalla est√° rota. Lo peor es que tengo que entregar un ensayo ma√±ana y la √∫nica copia que tengo est√° en mi port√°til.",
                "Llegaba tarde y tuve que correr para coger el autob√∫s. Me resbal√© y el port√°til se cay√≥ al suelo y me di cuenta del problema en cuanto me levant√©.",
                "Es bueno saber que tiene arreglo pero he visto un port√°til del mismo modelo y la misma marca a la venta en el escaparate y solo cuesta trescientos euros.",
                "Lo comprar√© si puedes copiar todos mis archivos al nuevo disco duro antes de salir de la tienda y si me das un bolso gratis para el port√°til.",
                "(Respuesta libre...)",
                ""
            ]
        },
        3: { 
            context: "Family thinking of hiring a camper van in Spain.", 
            prompts: [
                "1. Student calling from Ireland. Hire for 2 weeks in July.",
                "2. Mother driving (no license). Getting lessons, test in Autumn.",
                "3. Driven on right in Europe for 20 years. Careful driver.",
                "4. Spent time at coast. Travel through Castilla-La Mancha.",
                "5. Respond to the surprise question.",
                "Fin."
            ], 
            dialogs: [
                "¬°Hola! ¬øEn qu√© puedo ayudarte?",
                "Para alquilar un c√°mper hace falta tener al menos veinticinco a√±os y mucha experiencia al volante.",
                "Pues, muy bien. Tu madre cumple con los requisitos para alquilar un c√°mper.",
                "¬°Fenomenal! Os alquilo un c√°mper. ¬øTen√©is el itinerario previsto?",
                ["¬øA qu√© hora quer√©is recoger la furgoneta?","¬øQu√© tipo de m√∫sica os gusta escuchar en el coche?","¬øQu√© ciudades pens√°is visitar en vuestro viaje?"],
                "¬°Buen viaje y disfrutad de la experiencia!"
            ], 
            sugerencias: [
                "Soy estudiante y llamo desde Irlanda, me interesa alquilar un c√°mper durante dos semanas en julio.",
                "Mi madre va a conducir porque yo todav√≠a no tengo el carn√© de conducir. Estoy yendo a clases de conducir y espero aprobar el examen en oto√±o.",
                "Ha conducido por la derecha en varios pa√≠ses europeos durante los √∫ltimos veinte a√±os. Es una conductora muy prudente y nunca ha tenido un accidente.",
                "Hemos pasado mucho tiempo en la costa, pero este verano nos gustar√≠a viajar por Castilla-La Mancha para ver la tierra de Cervantes y Don Quijote, lejos de los turistas.",
                "(Respuesta libre...)",
                ""
            ]
        },
        4: { 
            context: "Pollution of the planet by single use plastics.", 
            prompts: [
                "1. EU agreed to ban single use plastics.",
                "2. Essential for waters. Serious problem in rivers/oceans.",
                "3. Use recycled paper, cardboard and biodegradable materials.",
                "4. Be responsible. Cycle, public transport or walk more.",
                "5. Respond to the surprise question.",
                "Fin."
            ], 
            dialogs: [
                "Pareces muy contento, ¬øpor qu√©?",
                "¬øEs importante prohibir pl√°sticos de usar y tirar?",
                "¬øPodemos hacer algo m√°s?",
                "Y, ¬øya est√°?",
                ["¬øQu√© cosas reciclas t√∫ en tu casa?","¬øA qu√© contenedor tiras las botellas de pl√°stico?","¬øQu√© opinas t√∫ de las bolsas de pl√°stico?"],
                "¬°Muy bien hecho!"
            ], 
            sugerencias: [
                "El Parlamento Europeo ha convenido prohibir los pl√°sticos de un solo uso, por ejemplo, los cuchillos, los tenedores, las cucharas, las tazas, los platos y las pajitas.",
                "S√≠, es absolutamente imprescindible. Ser√° muy bueno para las aguas del planeta. La contaminaci√≥n causada por los pl√°sticos es un problema grave en r√≠os, lagos y oc√©anos.",
                "Hay muchas cosas que podemos hacer. por ejemplo, en vez de usar pl√°sticos, podemos usar papel reciclado, cart√≥n y otros materiales biodegradables.",
                "No, como ciudadanos necesitamos ser m√°s responsables y cambiar nuestro estilo de vida. Para proteger el medio ambiente podr√≠amos ir en bicicleta, usar el transporte p√∫blico o caminar m√°s a menudo.",
                "(Respuesta libre...)",
                ""
            ]
        },
        5: { 
            context: "Driving from Madrid to Lugo on the AP-6 and car has stopped.", 
            prompts: [
                "1. Car broken down on AP-6. Passed toll half an hour ago.",
                "2. See exit sign 156. Send mechanic or tow truck.",
                "3. Replacement car for journey to Lugo. Collect parents.",
                "4. Red Seat Ibiza. 4620 CFK. Second hand from aunt.",
                "5. Respond to the surprise question.",
                "Fin."
            ], 
            dialogs: [
                "Hola, buenas tardes.",
                "Debes estar entre Medina del Campo y Tordesillas. ¬øHay alguna se√±al de tr√°fico por ah√≠?",
                "Claro que s√≠. Voy a arreglarlo todo inmediatamente.",
                "Por supuesto. ¬øMe puedes describir tu coche?",
                ["¬øCu√°ntas personas viajan contigo en el coche?","¬øA qu√© ciudad quieres ir con el coche de sustituci√≥n?","¬øC√≥mo te sientes despu√©s del susto del coche?"],
                "¬°Llegamos en 15 minutos!"
            ], 
            sugerencias: [
                "Mi coche acaba de averiarse y estoy en la autopista AP-6. No s√© exactamente donde estoy pero pas√© por el peaje hace media hora.",
                "Puedo ver la se√±al de salida 156 a lo lejos. ¬øPueden enviar un mec√°nico o quiz√°s una gr√∫a? Es que creo que el problema es serio.",
                "Podr√≠an darme un coche de sustituci√≥n para que pueda seguir mi viaje a Lugo. Tengo que recoger a mis padres en el aeropuerto de Santiago de Compostela.",
                "Es un Seat Ibiza rojo. La matricula es 4620 CFK. Se lo compr√© de segunda mano a mi t√≠a y nunca he tenido un problema con √©l antes.",
                "(Respuesta libre...)",
                ""
            ]
        }
    };

    function startApp() { 
        new Audio().play().catch(()=>{}); 
        document.getElementById('modal-instrucciones').style.display = 'none'; 
    }

    function setInputEnabled(e) { 
        document.getElementById('userInput').disabled = !e; 
        document.getElementById('sendBtn').disabled = !e; 
        document.getElementById('feedbackBtn').style.display = e ? "block" : "none"; 
        document.getElementById('userInput').placeholder = e ? "Escribe tu respuesta..." : "Escuchando..."; 
    }

    function seleccionarRP(id, btn) { 
        rpActual = id; 
        pasoActual = 0; 
        speaking = false;
        document.querySelectorAll('.rp-btn').forEach(b => b.classList.remove('active')); 
        btn.classList.add('active'); 
        document.getElementById('candidate-card').style.display = "block"; 
        document.getElementById('card-context').innerHTML = database[id].context; 
        document.getElementById('chat').innerHTML = ""; 
        document.getElementById('current-prompt').innerHTML = "Toca el BOT√ìN ROJO para o√≠r al examinador."; 
        document.getElementById('next-trigger').style.display = "block"; 
        setInputEnabled(false); 
    }

    function mostrarSugerencia() { 
        const sug = database[rpActual]?.sugerencias[pasoActual]; 
        if(sug) { 
            const fb = document.createElement('div'); 
            fb.className = 'feedback-box'; 
            fb.innerHTML = `üí° <b>Model Answer:</b> ${sug}`; 
            document.getElementById('chat').appendChild(fb); 
            document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight; 
        } 
    }

    function enviarRespuesta() { 
        const input = document.getElementById('userInput'); 
        const text = input.value.trim(); 
        if (!text || speaking) return; 
        document.getElementById('chat').innerHTML += `<div class="bubble st">${text}</div>`; 
        input.value = ""; 
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight; 
        setInputEnabled(false); 
        pasoActual++; 
        setTimeout(() => { 
            document.getElementById('next-trigger').style.display = "block"; 
        }, 300); 
    }

    function reproducirAudio(p, t) { 
        window.speechSynthesis.cancel(); 
        const a = new Audio(p); 
        const f = () => { 
            speaking = false; 
            if(pasoActual < (database[rpActual].dialogs.length - 1)) setInputEnabled(true); 
        }; 
        a.play().then(() => { 
            a.onended = f; 
        }).catch(() => { 
            const m = new SpeechSynthesisUtterance(t); 
            m.lang = 'es-ES'; 
            m.onend = f; 
            window.speechSynthesis.speak(m); 
        }); 
    }

    function proximaIntervencion() { 
        if (!rpActual || speaking) return; 
        document.getElementById('next-trigger').style.display = "none"; 
        speaking = true; 
        let t = database[rpActual].dialogs[pasoActual]; 
        let audioPath = ""; 
        
        if (Array.isArray(t)) { 
            let idx = Math.floor(Math.random() * t.length); 
            t = t[idx]; 
            audioPath = `rp${rpActual}_5${['a','b','c'][idx]}.mp3`; 
        } else { 
            audioPath = `rp${rpActual}_${pasoActual + 1}.mp3`; 
        } 
        
        const bubble = document.createElement('div'); 
        bubble.className = "bubble ex"; 
        bubble.innerHTML = `<b>Ex:</b> ${t}`; 
        bubble.onclick = () => reproducirAudio(audioPath, t); 
        document.getElementById('chat').appendChild(bubble); 
        document.getElementById('current-prompt').innerHTML = `<b>Prompt:</b> ${database[rpActual].prompts[pasoActual]}`; 
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight; 
        reproducirAudio(audioPath, t); 
    }
</script>
</body>
</html>
