<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SEC Spanish Oral Practice</title>
    <style>
        :root { --primary: #2c3e50; --secondary: #e74c3c; --accent: #3498db; --light-bg: #ecf0f1; --feedback: #2980b9; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background: var(--light-bg); color: #333; }
        header { background: var(--primary); color: white; padding: 15px; text-align: center; font-size: 1.1em; font-weight: bold; }
        
        .selector { display: flex; overflow-x: auto; gap: 10px; padding: 12px; background: #fff; border-bottom: 1px solid #ddd; flex-shrink: 0; }
        .rp-btn { min-width: 110px; padding: 10px; background: #fff; border: 2px solid #ddd; border-radius: 8px; font-size: 13px; cursor: pointer; text-align: center; }
        .active { border-color: var(--secondary); background: #fdf2f2; font-weight: bold; color: var(--secondary); }
        
        #candidate-card { background: #fffde7; border-left: 5px solid #f1c40f; padding: 15px; margin: 10px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: relative; }
        .card-context { font-style: italic; color: #7f8c8d; margin-bottom: 10px; border-bottom: 1px solid #e1e1e1; padding-bottom: 8px; font-size: 0.9em; line-height: 1.4; }
        .current-prompt { font-weight: bold; color: #2c3e50; background: #fdf9c4; padding: 5px; border-radius: 3px; font-size: 0.95em; padding-right: 40px; }
        
        /* Bot√≥n de Feedback */
        .btn-feedback { position: absolute; right: 10px; bottom: 10px; background: var(--feedback); color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-weight: bold; display: none; }

        #chat { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .bubble { max-width: 85%; padding: 12px 16px; border-radius: 18px; font-size: 16px; line-height: 1.4; }
        .ex { align-self: flex-start; background: white; border: 1px solid #dee2e6; border-bottom-left-radius: 2px; }
        .st { align-self: flex-end; background: #dcf8c6; border-bottom-right-radius: 2px; }
        .feedback-text { font-size: 0.85em; color: var(--feedback); font-style: italic; margin-top: 5px; display: block; background: #e1f5fe; padding: 8px; border-radius: 5px; border-left: 3px solid var(--feedback); }

        #next-trigger { display: none; margin: 10px auto; padding: 14px 24px; background: var(--secondary); color: white; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; width: 85%; font-size: 16px; box-shadow: 0 4px 12px rgba(231,76,60,0.3); }

        .input-area { background: white; padding: 15px 15px 35px 15px; display: flex; gap: 10px; border-top: 1px solid #ddd; }
        input { flex: 1; padding: 12px 18px; border-radius: 25px; border: 1px solid #ccc; font-size: 16px; outline: none; }
        .btn-send { background: var(--accent); color: white; border: none; width: 48px; height: 48px; border-radius: 50%; font-size: 20px; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<header>SEC Spanish Oral Practice</header>

<div class="selector">
    <div class="rp-btn" id="b1" onclick="seleccionarRP(1)">üè† 1. Alojamiento</div>
    <div class="rp-btn" id="b2" onclick="seleccionarRP(2)">üíª 2. Port√°til roto</div>
    <div class="rp-btn" id="b3" onclick="seleccionarRP(3)">üöê 3. Camper van</div>
    <div class="rp-btn" id="b4" onclick="seleccionarRP(4)">‚ôªÔ∏è 4. Medioambiente</div>
    <div class="rp-btn" id="b5" onclick="seleccionarRP(5)">üöó 5. Aver√≠a</div>
</div>

<div id="candidate-card" style="display:none;">
    <div class="card-context" id="card-context"></div>
    <div class="current-prompt" id="current-prompt"></div>
    <button class="btn-feedback" id="feedbackBtn" onclick="mostrarSugerencia()" title="Ver sugerencia">?</button>
</div>

<div id="chat"></div>
<button id="next-trigger" onclick="proximaIntervencion()">Tap to hear Examiner ‚è©</button>

<div class="input-area">
    <input type="text" id="userInput" placeholder="Select a scenario..." disabled>
    <button class="btn-send" id="sendBtn" onclick="enviarRespuesta()" disabled>‚ñ∂Ô∏è</button>
</div>

<script>
    let rpActual = null;
    let pasoActual = 0;
    let speaking = false;

    const database = {
        1: {
            context: "Vas de ERASMUS a la Universidad de Extremadura en C√°ceres. Necesitas alojamiento y llamas por tel√©fono a la universidad.",
            prompts: [
                "Say you will be on ERASMUS for the coming academic year. Say you don't know anybody in Caceres and ask for advice about accommodation.",
                "Say you would prefer to live near the university because last year you lived in the outskirts of Dublin and really didn't like it.",
                "Say you spent too much time travelling. Say that if you could spend that time studying you would get good grades.",
                "Say that's not far and the climate is much better than in Ireland so you will consider all areas even though you would prefer the city centre.",
                "Respond to the examiner's question.",
                "Role Play finished."
            ],
            dialogs: [
                "¬°Hola, d√≠game!",
                "¬øEn qu√© parte de la ciudad querr√≠as vivir?",
                "¬øPor qu√©?",
                "Tienes raz√≥n. Pero sabes que C√°ceres es una ciudad muy peque√±a y se puede andar desde las afueras a la Plaza Mayor en media hora.",
                ["¬øHas estado alguna vez en C√°ceres?", "¬øQu√© te gusta de Espa√±a?", "¬øPrefieres piso compartido o residencia?"],
                "Hemos terminado, gracias."
            ],
            sugerencias: [
                "Hola, voy a ir de ERASMUS el pr√≥ximo a√±o acad√©mico. No conozco a nadie en C√°ceres, ¬øpodr√≠a darme alg√∫n consejo sobre el alojamiento?",
                "Preferir√≠a vivir cerca de la universidad porque el a√±o pasado viv√≠ en las afueras de Dubl√≠n y no me gust√≥ nada.",
                "Pasaba demasiado tiempo viajando. Si pudiera dedicar ese tiempo a estudiar, sacar√≠a buenas notas.",
                "Eso no est√° lejos y el clima es mucho mejor que en Irlanda, as√≠ que considerar√© todas las zonas aunque preferir√≠a el centro.",
                "(Responde libremente a la pregunta del examinador)",
                ""
            ]
        },
        2: {
            context: "Est√°s en √Åvila y se te ha roto el port√°til. Lo llevas a arreglar.",
            prompts: [
                "Say your laptop fell and the screen is broken. You have an essay due for tomorrow and the only copy is on the laptop.",
                "Say you were late for the bus, you slipped and the laptop fell on the ground.",
                "Say it's good it can be fixed but you saw the same model in the window for 300 euro.",
                "Say you will buy it if they copy your files to the new drive and give you a free bag.",
                "Respond to the examiner's question.",
                "Examen finalizado."
            ],
            dialogs: [
                "¬°Hola! ¬øEn qu√© puedo ayudarte?",
                "Vamos a ver. ¬øQu√© te pas√≥?",
                "Vas a necesitar una nueva pantalla que cuesta doscientos euros.",
                "S√≠, hay una oferta especial esta semana. ¬øQuieres comprarlo?",
                ["¬øUsas mucho el ordenador?", "¬øPrefieres Mac o Windows?", "¬øQu√© marca es tu port√°til?"],
                "Examen finalizado."
            ],
            sugerencias: [
                "Hola, se me ha ca√≠do el port√°til y la pantalla est√° rota. Tengo un ensayo para ma√±ana y la √∫nica copia est√° en el ordenador.",
                "Es que llegaba tarde al autob√∫s, me resbal√© y el port√°til se cay√≥ al suelo.",
                "Qu√© bien que se pueda arreglar, pero he visto el mismo modelo en el escaparate por trescientos euros.",
                "Lo comprar√© si pueden copiar mis archivos al nuevo disco duro y si me dan un malet√≠n gratis.",
                "(Responde libremente)",
                ""
            ]
        }
        // (Nota: Situaciones 3, 4 y 5 siguen el mismo patr√≥n de sugerencias)
    };

    function setInputEnabled(enabled) {
        const input = document.getElementById('userInput');
        const btn = document.getElementById('sendBtn');
        input.disabled = !enabled;
        btn.disabled = !enabled;
        input.placeholder = enabled ? "Escribe o usa el micro..." : "Esperando...";
        document.getElementById('feedbackBtn').style.display = enabled ? "block" : "none";
    }

    function seleccionarRP(id) {
        rpActual = id; pasoActual = 0; speaking = false;
        window.speechSynthesis.cancel();
        document.querySelectorAll('.rp-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('b' + id).classList.add('active');
        document.getElementById('candidate-card').style.display = "block";
        document.getElementById('card-context').innerHTML = database[id].context;
        document.getElementById('current-prompt').innerHTML = "Pulsa el BOT√ìN ROJO para empezar.";
        document.getElementById('chat').innerHTML = "";
        document.getElementById('next-trigger').style.display = "block";
        setInputEnabled(false);
    }

    function mostrarSugerencia() {
        const sug = database[rpActual].sugerencias[pasoActual];
        if(sug) {
            document.getElementById('chat').innerHTML += `<div class="feedback-text">üí° <b>Sugerencia:</b> ${sug}</div>`;
            document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
        }
    }

    function enviarRespuesta() {
        if (!rpActual || speaking) return;
        const input = document.getElementById('userInput');
        const texto = input.value.trim();
        if (!texto) return;

        window.speechSynthesis.speak(new SpeechSynthesisUtterance("")); 
        document.getElementById('chat').innerHTML += `<div class="bubble st">${texto}</div>`;
        input.value = "";
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
        
        setInputEnabled(false);
        setTimeout(() => { document.getElementById('next-trigger').style.display = "block"; }, 500);
    }

    function proximaIntervencion() {
        if (!rpActual || speaking) return;
        document.getElementById('next-trigger').style.display = "none";
        speaking = true;

        let t = database[rpActual].dialogs[pasoActual];
        let audioPath = "";

        if (Array.isArray(t)) {
            let index = Math.floor(Math.random() * t.length);
            t = t[index];
            let letras = ['a', 'b', 'c'];
            audioPath = `rp${rpActual}_5${letras[index]}.mp3`;
        } else {
            audioPath = `rp${rpActual}_${pasoActual + 1}.mp3`;
        }

        document.getElementById('chat').innerHTML += `<div class="bubble ex"><b>Examinador:</b> ${t}</div>`;
        document.getElementById('current-prompt').innerHTML = `<b>Prompt:</b> ${database[rpActual].prompts[pasoActual]}`;
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;

        const finalizarTurno = () => {
            speaking = false;
            if (pasoActual < database[rpActual].dialogs.length - 1) {
                setInputEnabled(true);
            }
        };

        const audio = new Audio(audioPath);
        audio.play().then(() => {
            audio.onended = finalizarTurno;
        }).catch(() => {
            hablarRobot(t, finalizarTurno);
        });
    }

    function hablarRobot(texto, onEndCb) {
        window.speechSynthesis.cancel();
        const m = new SpeechSynthesisUtterance(texto);
        m.lang = 'es-ES'; m.rate = 0.85;
        m.onend = onEndCb;
        window.speechSynthesis.speak(m);
    }
</script>
</body>
</html>
