<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LC Oral Master - Se√±or Mart√≠n</title>
    <style>
        :root { --primary: #1a237e; --secondary: #c62828; }
        body { font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background: #e5ddd5; }
        header { background: var(--primary); color: white; padding: 10px; text-align: center; font-weight: bold; }
        .selector { display: flex; overflow-x: auto; gap: 8px; padding: 10px; background: #fff; border-bottom: 2px solid #ccc; flex-shrink: 0; }
        .rp-btn { min-width: 90px; padding: 10px; background: #f8f8f8; border: 1px solid #999; border-radius: 8px; font-size: 12px; cursor: pointer; border: 1px solid #ccc; }
        .active { background: var(--secondary) !important; color: white; }
        #chat { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .bubble { max-width: 80%; padding: 12px; border-radius: 12px; font-size: 16px; line-height: 1.4; }
        .ex { align-self: flex-start; background: white; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .st { align-self: flex-end; background: #dcf8c6; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        #next-trigger { display: none; margin: 10px auto; padding: 15px; background: var(--secondary); color: white; border: none; border-radius: 25px; font-weight: bold; cursor: pointer; width: 80%; }
        .input-area { background: white; padding: 10px 10px 30px 10px; display: flex; gap: 10px; border-top: 1px solid #ccc; }
        input { flex: 1; padding: 12px; border-radius: 20px; border: 1px solid #ccc; font-size: 16px; }
        .btn { background: var(--primary); color: white; border: none; padding: 10px 15px; border-radius: 50%; font-size: 20px; }
    </style>
</head>
<body>

<header>Se√±or Mart√≠n: Simulador Oficial SEC</header>

<div class="selector">
    <div class="rp-btn" id="b1" onclick="iniciarExamen(1)">üè† 1. C√°ceres</div>
    <div class="rp-btn" id="b2" onclick="iniciarExamen(2)">üíª 2. √Åvila</div>
    <div class="rp-btn" id="b3" onclick="iniciarExamen(3)">üöê 3. Caravana</div>
    <div class="rp-btn" id="b4" onclick="iniciarExamen(4)">‚ôªÔ∏è 4. Pl√°sticos</div>
    <div class="rp-btn" id="b5" onclick="iniciarExamen(5)">üöó 5. Aver√≠a</div>
</div>

<div id="chat"></div>

<button id="next-trigger" onclick="proximaIntervencion()">Pulsar para escuchar al examinador ‚è©</button>

<div class="input-area">
    <button class="btn" id="micBtn" onclick="activarMicro()">üéôÔ∏è</button>
    <input type="text" id="userInput" placeholder="Escribe o usa el micro...">
    <button class="btn" onclick="enviarRespuesta()">‚ñ∂Ô∏è</button>
</div>

<script>
    let rpActual = null;
    let pasoActual = 0;
    let reconocimiento;

    const contenido = {
        1: ["¬°Hola, d√≠game!", "Entiendo que vas a estudiar un a√±o en C√°ceres. ¬øEn qu√© parte de la ciudad querr√≠as vivir?", "¬øPor qu√©?", "Tienes raz√≥n, pero C√°ceres es peque√±a y se puede ir andando a la Plaza Mayor en media hora desde las afueras.", ["¬øHas estado alguna vez en C√°ceres?", "¬øQu√© es lo que m√°s te gusta de vivir en Espa√±a?", "¬øPor qu√© quieres estudiar en Espa√±a?"], "Hemos terminado, gracias."],
        2: ["Buenos d√≠as. ¬øEn qu√© puedo ayudarte?", "¬øQu√© le ha pasado exactamente a la pantalla?", "¬øTienes copia de seguridad?", "Te lo arreglo hoy por 300‚Ç¨. ¬øQu√© te parece?", ["¬øUsas mucho el PC?", "¬øPrefieres Mac o Windows?", "¬øHas tenido problemas antes?"], "Examen finalizado."],
        3: ["Hola. ¬øQuieres alquilar una autocaravana?", "¬øQui√©n va a conducir?", "¬øTu madre ha tenido alg√∫n accidente?", "¬øQu√© ciudades quer√©is visitar?", ["¬øTe gusta acampar?", "¬øPrefieres verano o invierno?", "¬øHas conducido algo grande?"], "Role Play completado."],
        4: ["¬°Hola! ¬øPor qu√© est√°s tan contento?", "¬øCu√°ndo entra en vigor la prohibici√≥n europea?", "¬øQu√© materiales usar√≠as?", "Nosotros reciclamos siempre. ¬øY t√∫?", ["¬øTu colegio recicla?", "¬øQu√© opinas del cambio clim√°tico?", "¬øUsas cristal?"], "¬°Muy bien!"],
        5: ["¬°Hola, buenas tardes!", "¬øVes alguna se√±al de tr√°fico por la salida 156?", "¬øMe puedes describir tu coche?", "¬øLlevas mucho tiempo esperando?", ["¬øHas llamado a tu familia?", "¬øSabes cambiar una rueda?", "¬øConoces esta zona?"], "El mec√°nico llegar√° pronto."]
    };

    function iniciarExamen(id) {
        rpActual = id; pasoActual = 0;
        document.querySelectorAll('.rp-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('b'+id).classList.add('active');
        document.getElementById('chat').innerHTML = "";
        document.getElementById('next-trigger').style.display = "none";
        proximaIntervencion();
    }

    function enviarRespuesta() {
        let input = document.getElementById('userInput');
        if (!input.value) return;
        
        let chat = document.getElementById('chat');
        chat.innerHTML += `<div class="bubble st">${input.value}</div>`;
        input.value = "";
        chat.scrollTop = chat.scrollHeight;

        if (pasoActual < contenido[rpActual].length) {
            document.getElementById('next-trigger').style.display = "block";
        }
    }

    function proximaIntervencion() {
        document.getElementById('next-trigger').style.display = "none";
        let t = contenido[rpActual][pasoActual];
        let nombreAudio = "";

        // L√≥gica de aleatoriedad
        if (pasoActual === 4) {
            let letras = ['a', 'b', 'c'];
            let r = Math.floor(Math.random() * 3);
            t = contenido[rpActual][4][r];
            nombreAudio = `rp${rpActual}_5${letras[r]}.mp3`;
        } else if (pasoActual === 5) {
            nombreAudio = `rp${rpActual}_6.mp3`;
        } else {
            nombreAudio = `rp${rpActual}_${pasoActual + 1}.mp3`;
        }

        document.getElementById('chat').innerHTML += `<div class="bubble ex"><b>Examinador:</b> ${t}</div>`;
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;

        // Intentar audio MP3 si es RP1, si no, robot
        if (rpActual === 1) {
            let audio = new Audio(nombreAudio);
            audio.play().catch(() => hablarRobot(t));
        } else {
            hablarRobot(t);
        }
        pasoActual++;
    }

    function hablarRobot(texto) {
        window.speechSynthesis.cancel();
        let m = new SpeechSynthesisUtterance(texto);
        m.lang = 'es-ES'; m.rate = 0.9;
        window.speechSynthesis.speak(m);
    }

    function activarMicro() {
        let Reco = window.webkitSpeechRecognition || window.SpeechRecognition;
        if (!Reco) return alert("Navegador no compatible");
        
        reconocimiento = new Reco();
        reconocimiento.lang = 'es-ES';
        reconocimiento.onstart = () => document.getElementById('micBtn').style.background = 'red';
        reconocimiento.onresult = (e) => {
            document.getElementById('userInput').value = e.results[0][0].transcript;
        };
        reconocimiento.onend = () => document.getElementById('micBtn').style.background = '#1a237e';
        reconocimiento.start();
    }
</script>
</body>
</html>
