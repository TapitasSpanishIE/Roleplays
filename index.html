<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SEC Practice - Sr. Mart√≠n</title>
    <style>
        :root { --primary: #2c3e50; --secondary: #e74c3c; --accent: #3498db; --light-bg: #ecf0f1; --feedback: #2980b9; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background: var(--light-bg); color: #333; }
        
        /* Estilos del Manual / Modal */
        #modal-instrucciones { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); display:flex; align-items:center; justify-content:center; z-index:2000; }
        .modal-content { background: white; padding: 25px; border-radius: 15px; max-width: 85%; text-align: left; box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
        .modal-content h2 { color: var(--secondary); margin-top: 0; text-align: center; }
        .modal-content p { font-size: 0.95em; line-height: 1.4; }
        .btn-close { display: block; width: 100%; background: var(--primary); color: white; padding: 12px; border: none; border-radius: 8px; cursor: pointer; margin-top: 15px; font-weight: bold; font-size: 1em; }

        header { background: var(--primary); color: white; padding: 15px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .author-tag { font-size: 0.8em; color: #3498db; font-weight: bold; display: block; margin-top: 5px; text-transform: uppercase; }
        
        .selector { display: flex; overflow-x: auto; gap: 10px; padding: 12px; background: #fff; border-bottom: 1px solid #ddd; flex-shrink: 0; }
        .rp-btn { min-width: 110px; padding: 10px; background: #fff; border: 2px solid #ddd; border-radius: 8px; font-size: 13px; cursor: pointer; text-align: center; }
        .active { border-color: var(--secondary); background: #fdf2f2; font-weight: bold; color: var(--secondary); }
        
        #candidate-card { background: #fffde7; border-left: 5px solid #f1c40f; padding: 15px; margin: 10px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: relative; min-height: 80px; display: none; }
        .card-context { font-style: italic; color: #7f8c8d; margin-bottom: 10px; border-bottom: 1px solid #e1e1e1; padding-bottom: 8px; font-size: 0.85em; }
        .current-prompt { font-weight: bold; color: #2c3e50; background: #fdf9c4; padding: 5px; border-radius: 3px; font-size: 0.95em; padding-right: 45px; }
        
        .btn-feedback { position: absolute; right: 8px; bottom: 8px; background: var(--feedback); color: white; border: none; border-radius: 50%; width: 34px; height: 34px; cursor: pointer; font-weight: bold; font-size: 18px; display: none; }

        #chat { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .bubble { max-width: 85%; padding: 12px 16px; border-radius: 18px; font-size: 16px; line-height: 1.4; }
        .ex { align-self: flex-start; background: white; border: 1px solid #dee2e6; }
        .st { align-self: flex-end; background: #dcf8c6; }
        .feedback-box { font-size: 0.85em; color: var(--feedback); background: #e1f5fe; padding: 10px; border-radius: 8px; border-left: 4px solid var(--feedback); margin: 5px 0; align-self: center; width: 90%; }
        
        #next-trigger { display: none; margin: 10px auto; padding: 14px 24px; background: var(--secondary); color: white; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; width: 85%; font-size: 16px; }

        .input-area { background: white; padding: 15px 15px 35px 15px; display: flex; gap: 10px; border-top: 1px solid #ddd; }
        input { flex: 1; padding: 12px 18px; border-radius: 25px; border: 1px solid #ccc; font-size: 16px; outline: none; }
        .btn-send { background: var(--accent); color: white; border: none; width: 48px; height: 48px; border-radius: 50%; font-size: 20px; }
    </style>
</head>
<body>

<div id="modal-instrucciones">
    <div class="modal-content">
        <h2>How to use this Simulator</h2>
        <p><b>1. Select a Topic:</b> Tap a scenario at the top.</p>
        <p><b>2. Listen:</b> Tap the red <b>‚è© button</b> to hear the Examiner.</p>
        <p><b>3. Your Turn:</b> Read the yellow card. To respond, tap the <b>microphone icon üé§</b> on your keyboard (or type) and press the blue <b>‚ñ∂Ô∏è button</b> to finish your turn. <i>*Crucial: You must send your answer to progress!</i></p>
        <p><b>4. Need Help?</b> Tap the blue <b>?</b> button for a model answer.</p>
        <button class="btn-close" onclick="document.getElementById('modal-instrucciones').style.display='none'">START PRACTICE</button>
    </div>
</div>

<header>
    SEC Spanish Oral Practice
    <span class="author-tag">Created by Sr. Mart√≠n</span>
</header>

<div class="selector">
    <div class="rp-btn" id="b1" onclick="seleccionarRP(1)">üè† 1. Alojamiento</div>
    <div class="rp-btn" id="b2" onclick="seleccionarRP(2)">üíª 2. Port√°til</div>
    <div class="rp-btn" id="b3" onclick="seleccionarRP(3)">üöê 3. Camper van</div>
    <div class="rp-btn" id="b4" onclick="seleccionarRP(4)">‚ôªÔ∏è 4. Pl√°sticos</div>
    <div class="rp-btn" id="b5" onclick="seleccionarRP(5)">üöó 5. Aver√≠a</div>
</div>

<div id="candidate-card">
    <div class="card-context" id="card-context"></div>
    <div class="current-prompt" id="current-prompt"></div>
    <button class="btn-feedback" id="feedbackBtn" onclick="mostrarSugerencia()">?</button>
</div>

<div id="chat"></div>
<button id="next-trigger" onclick="proximaIntervencion()">Tap to hear Examiner ‚è©</button>

<div class="input-area">
    <input type="text" id="userInput" placeholder="Select a scenario..." disabled>
    <button class="btn-send" id="sendBtn" onclick="enviarRespuesta()" disabled>‚ñ∂Ô∏è</button>
</div>

<script>
    let rpActual = null;
    let pasoActual = 0;
    let speaking = false;

    const database = {
        1: {
            context: "Vas de ERASMUS a la Universidad de Extremadura en C√°ceres. Necesitas alojamiento y llamas por tel√©fono a la universidad.",
            prompts: [
                "1. Say you'll be on ERASMUS next year. Ask for accommodation advice.",
                "2. Say you'd prefer to live near the university (Dublin outskirts experience).",
                "3. You spent too much time travelling. If you could study that time, you'd get good grades.",
                "4. Say climate is better than Ireland. Consider all areas even if you prefer center.",
                "5. Answer the surprise question.",
                "Finished."
            ],
            dialogs: [
                "¬°Hola, d√≠game!",
                "¬øEn qu√© parte de la ciudad querr√≠as vivir?",
                "¬øPor qu√©?",
                "Tienes raz√≥n. Pero sabes que C√°ceres es una ciudad muy peque√±a y se puede andar desde las afueras a la Plaza Mayor en media hora.",
                ["¬øHas estado en Espa√±a?", "¬øPrefieres piso o residencia?"],
                "¬°Suerte!"
            ],
            sugerencias: [
                "Hola, voy a ir de ERASMUS el pr√≥ximo a√±o acad√©mico. No conozco a nadie en C√°ceres, ¬øpodr√≠a darme alg√∫n consejo?",
                "Preferir√≠a vivir cerca de la universidad porque el a√±o pasado viv√≠ en las afueras de Dubl√≠n y no me gust√≥.",
                "Pasaba demasiado tiempo viajando. Si pudiera dedicar ese tiempo a estudiar, sacar√≠a mejores notas.",
                "El clima es mucho mejor que en Irlanda, as√≠ que considerar√© todas las zonas aunque prefiera el centro.",
                "S√≠, estuve el verano pasado en Valencia...",
                ""
            ]
        },
        2: {
            context: "Laptop broken in Avila.",
            prompts: ["1. Screen broken. Essay due tomorrow.", "2. Slipped and fell.", "3. Saw same for 300‚Ç¨.", "4. Buy if files copied + free bag.", "5. Answer question.", "Fin."],
            dialogs: ["¬°Hola!", "¬øQu√© pas√≥?", "200 euros cuesta.", "Oferta: ¬øquieres?", ["¬øQu√© marca es?"], "Fin."],
            sugerencias: ["Se me ha ca√≠do el port√°til y la pantalla est√° rota. Tengo un ensayo para ma√±ana...", "Llegaba tarde al bus, me resbal√© y se cay√≥.", "Qu√© bien, pero he visto el mismo por 300 euros en el escaparate.", "Lo compro si copian mis archivos y me dan un malet√≠n gratis.", "Es un Dell de hace dos a√±os.", ""]
        },
        3: {
            context: "Hiring a camper van.",
            prompts: ["1. Irish student, hire for July.", "2. Mother driving.", "3. Driven on right 20 years.", "4. Castilla-La Mancha.", "5. Answer.", "Fin."],
            dialogs: ["¬°D√≠game!", "Hace falta ser mayor de 25.", "Perfecto.", "¬øItinerario?", ["¬øTe gusta acampar?"], "Fin."],
            sugerencias: ["Soy un estudiante de Irlanda y quiero alquilar una autocaravana en julio.", "Mi madre conducir√° porque yo no tengo carn√© todav√≠a.", "Ella ha conducido por la derecha 20 a√±os y es muy cuidadosa.", "Queremos ver la tierra de Cervantes.", "S√≠, me gusta la libertad de dormir en la naturaleza.", ""]
        },
        4: {
            context: "Plastic pollution.",
            prompts: ["1. EU ban plastics.", "2. Essential for waters.", "3. Recycled paper.", "4. Citizens responsibility.", "5. Answer.", "Fin."],
            dialogs: ["¬øPor qu√© est√°s contento?", "¬øEs importante prohibir?", "¬øAlgo m√°s?", "¬øY ya est√°?", ["¬øRecicl√°is en el colegio?"], "Fin."],
            sugerencias: ["La UE va a prohibir los pl√°sticos de un solo uso.", "Es esencial para los oc√©anos.", "Podemos usar materiales biodegradables.", "Los ciudadanos deben ser responsables e ir en bici.", "S√≠, reciclamos papel y latas.", ""]
        },
        5: {
            context: "Car breakdown on AP-6.",
            prompts: ["1. Broken down on AP-6.", "2. Exit 156. Ask for mechanic.", "3. Replacement car (Lugo).", "4. Red SEAT Ibiza (from aunt).", "5. Answer.", "Fin."],
            dialogs: ["Buenas tardes.", "¬øAlguna se√±al?", "Enviar√© ayuda.", "¬øC√≥mo es el coche?", ["¬øSabes cambiar ruedas?"], "Fin."],
            sugerencias: ["Mi coche se ha averiado en la AP-6. Pas√© el peaje hace media hora.", "Veo la se√±al 156. ¬øPuede enviarme una gr√∫a?", "¬øPuedo tener un coche de sustituci√≥n para ir a Lugo?", "Es un SEAT Ibiza rojo que le compr√© a mi t√≠a.", "No, nunca lo he intentado.", ""]
        }
    };

    function setInputEnabled(enabled) {
        document.getElementById('userInput').disabled = !enabled;
        document.getElementById('sendBtn').disabled = !enabled;
        document.getElementById('feedbackBtn').style.display = enabled ? "block" : "none";
    }

    function seleccionarRP(id) {
        rpActual = id; pasoActual = 0; speaking = false;
        window.speechSynthesis.cancel();
        document.querySelectorAll('.rp-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('b' + id).classList.add('active');
        document.getElementById('candidate-card').style.display = "block";
        document.getElementById('card-context').innerHTML = database[id].context;
        document.getElementById('current-prompt').innerHTML = "Tap the RED BUTTON to hear the Examiner.";
        document.getElementById('chat').innerHTML = "";
        document.getElementById('next-trigger').style.display = "block";
        setInputEnabled(false);
    }

    function mostrarSugerencia() {
        const sug = database[rpActual].sugerencias[pasoActual];
        if(sug) {
            document.getElementById('chat').innerHTML += `<div class="feedback-box">üí° <b>Model:</b> ${sug}</div>`;
            document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
        }
    }

    function enviarRespuesta() {
        if (!rpActual || speaking) return;
        const input = document.getElementById('userInput');
        const texto = input.value.trim();
        if (!texto) return;
        window.speechSynthesis.speak(new SpeechSynthesisUtterance("")); 
        document.getElementById('chat').innerHTML += `<div class="bubble st">${texto}</div>`;
        input.value = "";
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
        setInputEnabled(false);
        pasoActual++;
        setTimeout(() => { document.getElementById('next-trigger').style.display = "block"; }, 300);
    }

    function proximaIntervencion() {
        if (!rpActual || speaking) return;
        document.getElementById('next-trigger').style.display = "none";
        speaking = true;
        let t = database[rpActual].dialogs[pasoActual];
        let audioPath = "";

        if (Array.isArray(t)) {
            let idx = Math.floor(Math.random() * t.length);
            t = t[idx];
            audioPath = `rp${rpActual}_5${['a','b','c'][idx]}.mp3`;
        } else {
            audioPath = `rp${rpActual}_${pasoActual + 1}.mp3`;
        }

        document.getElementById('chat').innerHTML += `<div class="bubble ex"><b>Ex:</b> ${t}</div>`;
        document.getElementById('current-prompt').innerHTML = `<b>Prompt:</b> ${database[rpActual].prompts[pasoActual]}`;
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;

        const finalizarTurno = () => {
            speaking = false;
            if (pasoActual < database[rpActual].dialogs.length - 1) setInputEnabled(true);
        };
        new Audio(audioPath).play().then(a => a.onended = finalizarTurno).catch(() => hablarRobot(t, finalizarTurno));
    }

    function hablarRobot(texto, cb) {
        const m = new SpeechSynthesisUtterance(texto);
        m.lang = 'es-ES'; m.onend = cb;
        window.speechSynthesis.speak(m);
    }
</script>
</body>
</html>
