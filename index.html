<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SEC Practice - ayuda Sr. Mart√≠n</title>
    <style>
        :root { --primary: #2c3e50; --secondary: #e74c3c; --accent: #3498db; --light-bg: #ecf0f1; --feedback: #2980b9; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background: var(--light-bg); color: #333; overflow: hidden; }
        
        #modal-instrucciones { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); display:flex; align-items:center; justify-content:center; z-index:9999; padding: 20px; box-sizing: border-box; }
        .modal-content { background: white; padding: 25px; border-radius: 15px; max-width: 500px; width: 100%; text-align: left; box-shadow: 0 5px 30px rgba(0,0,0,0.5); }
        .modal-content h2 { color: var(--secondary); margin-top: 0; text-align: center; font-size: 1.5em; }
        .welcome-msg { font-style: italic; color: var(--primary); margin-bottom: 15px; border-bottom: 2px solid #f1f1f1; padding-bottom: 10px; text-align: center; line-height: 1.4; }
        .btn-close { display: block; width: 100%; background: var(--primary); color: white; padding: 15px; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px; font-weight: bold; font-size: 1.1em; }

        header { background: var(--primary); color: white; padding: 12px; text-align: center; flex-shrink: 0; }
        .author-tag { font-size: 0.85em; color: #3498db; font-weight: bold; display: block; margin-top: 4px; }
        
        .selector { display: flex; overflow-x: auto; gap: 10px; padding: 12px; background: #fff; border-bottom: 1px solid #ddd; flex-shrink: 0; }
        .rp-btn { min-width: 120px; padding: 10px; background: #fff; border: 2px solid #ddd; border-radius: 8px; font-size: 13px; cursor: pointer; white-space: nowrap; }
        .active { border-color: var(--secondary); background: #fdf2f2; font-weight: bold; color: var(--secondary); }
        
        #candidate-card { background: #fffde7; border-left: 5px solid #f1c40f; padding: 15px; margin: 10px; border-radius: 4px; min-height: 90px; flex-shrink: 0; display: none; position: relative; }
        .card-context { font-style: italic; color: #7f8c8d; margin-bottom: 8px; font-size: 0.85em; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .current-prompt { font-weight: bold; color: #2c3e50; font-size: 0.95em; line-height: 1.4; padding-right: 45px; }
        
        /* Bot√≥n de Ayuda (?) Restaurado */
        .btn-feedback { position: absolute; right: 10px; bottom: 10px; background: var(--feedback); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-weight: bold; font-size: 22px; display: none; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        #chat { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 12px; background: #f9f9f9; }
        .bubble { max-width: 85%; padding: 12px 16px; border-radius: 18px; font-size: 16px; line-height: 1.4; position: relative; }
        .ex { align-self: flex-start; background: white; border: 1px solid #dee2e6; cursor: pointer; }
        .ex::after { content: ' üîä'; font-size: 0.7em; opacity: 0.4; margin-left: 5px; }
        .st { align-self: flex-end; background: #dcf8c6; color: #000; }
        
        .feedback-box { font-size: 0.9em; color: var(--feedback); background: #e1f5fe; padding: 12px; border-radius: 10px; border-left: 5px solid var(--feedback); margin: 5px 0; align-self: center; width: 90%; }
        
        #next-trigger { display: none; margin: 10px auto; padding: 15px; background: var(--secondary); color: white; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; width: 85%; font-size: 16px; flex-shrink: 0; }

        .input-area { background: white; padding: 15px 15px 30px 15px; display: flex; gap: 10px; border-top: 1px solid #ddd; flex-shrink: 0; }
        input { flex: 1; padding: 14px 20px; border-radius: 30px; border: 2px solid #eee; font-size: 16px; outline: none; }
        .btn-send { background: var(--accent); color: white; border: none; width: 50px; height: 50px; border-radius: 50%; font-size: 20px; cursor: pointer; flex-shrink: 0; }
    </style>
</head>
<body>

<div id="modal-instrucciones">
    <div class="modal-content">
        <h2>¬°Bienvenidos a TapitasSpanishIE!</h2>
        <p class="welcome-msg">I hope you find this Role Play simulator very useful for your Leaving Cert preparation. ¬°Mucho √°nimo!</p>
        <p><b>1. Select Scenario.</b><br><b>2. Red Button:</b> Listen to Examiner.<br><b>3. Blue Arrow:</b> Send answer.<br><b>4. Blue ? Button:</b> See a model answer.<br><b>5. Tap Examiner:</b> Repeat audio.</p>
        <button class="btn-close" onclick="document.getElementById('modal-instrucciones').style.display='none'">START PRACTICE</button>
    </div>
</div>

<header>
    SEC Spanish Oral Practice
    <span class="author-tag">Created by Sr. Mart√≠n</span>
</header>

<div class="selector">
    <div class="rp-btn" id="b1" onclick="seleccionarRP(1)">üè† 1. Alojamiento</div>
    <div class="rp-btn" id="b2" onclick="seleccionarRP(2)">üíª 2. Port√°til</div>
    <div class="rp-btn" id="b3" onclick="seleccionarRP(3)">üöê 3. Camper van</div>
    <div class="rp-btn" id="b4" onclick="seleccionarRP(4)">‚ôªÔ∏è 4. Pl√°sticos</div>
    <div class="rp-btn" id="b5" onclick="seleccionarRP(5)">üöó 5. Aver√≠a</div>
</div>

<div id="candidate-card">
    <div class="card-context" id="card-context"></div>
    <div class="current-prompt" id="current-prompt"></div>
    <button class="btn-feedback" id="feedbackBtn" onclick="mostrarSugerencia()">?</button>
</div>

<div id="chat"></div>
<button id="next-trigger" onclick="proximaIntervencion()">Tap to hear Examiner ‚è©</button>

<div class="input-area">
    <input type="text" id="userInput" placeholder="Select scenario..." disabled>
    <button class="btn-send" id="sendBtn" onclick="enviarRespuesta()" disabled>‚ñ∂Ô∏è</button>
</div>

<script>
    let rpActual = null;
    let pasoActual = 0;
    let speaking = false;

    const database = {
        1: {
            context: "ERASMUS en C√°ceres. Llamas por alojamiento.",
            prompts: ["1. ERASMUS next year. Ask for advice.","2. Near uni (Dublin outskirts experience).","3. Travelling too long. Study = good grades.","4. Better climate. All areas ok but prefer center.","5. Respond to the surprise question.","Finished."],
            dialogs: ["¬°Hola, d√≠game!","¬øEn qu√© parte de la ciudad querr√≠as vivir?","¬øPor qu√©?","Tienes raz√≥n. Pero sabes que C√°ceres es una ciudad muy peque√±a y se puede andar desde las afueras a la Plaza Mayor en media hora.",["¬øHas estado alguna vez en Espa√±a?","¬øQu√© es lo que m√°s te gusta de vivir en Espa√±a?","¬øPor qu√© quieres estudiar en Espa√±a?"],"¬°Mucha suerte en C√°ceres!"],
            sugerencias: ["Hola, voy a ir de ERASMUS el a√±o que viene. ¬øPodr√≠a darme alg√∫n consejo sobre el alojamiento?","Preferir√≠a vivir cerca de la universidad porque el a√±o pasado viv√≠ en las afueras de Dubl√≠n y no me gust√≥.","Pasaba demasiado tiempo viajando. Si pudiera dedicar ese tiempo a estudiar, sacar√≠a mejores notas.","Bueno, el clima es mucho mejor que en Irlanda, as√≠ que considerar√© todas las zonas aunque preferir√≠a el centro.","(Responde libremente a la pregunta...)",""]
        },
        2: { context: "Port√°til roto √Åvila.", prompts: ["1. Screen broken.","2. Slipped.","3. 200‚Ç¨ vs 300‚Ç¨.","4. Copy files.","5. Answer question.","Fin."], dialogs: ["¬°Hola! ¬øEn qu√© puedo ayudarte?","¬øC√≥mo se rompi√≥?","Arreglarlo cuesta 200 euros.","Esta semana hay oferta. ¬øLo quieres? ",["¬øQu√© marca es?","¬øUsas mucho el ordenador?"],"¬°Examen finalizado!"], sugerencias: ["Hola, se me ha ca√≠do el port√°til y la pantalla est√° rota.","Me resbal√© yendo al bus y se cay√≥.","He visto el mismo modelo por 300 euros en el escaparate.","Lo comprar√© si pueden copiar mis archivos.","Uso el ordenador para todos mis trabajos de clase.",""]},
        3: { context: "Camper Van.", prompts: ["1. July.","2. Mother driving.","3. Careful driver.","4. Cervantes.","5. Answer question.","Fin."], dialogs: ["¬°D√≠game!","Debes ser mayor de 25 a√±os.","Ah, entonces ella puede conducir.","¬øTen√©is una ruta ya pensada? ",["¬øTe gusta viajar de acampada?","¬øPrefieres mar o monta√±a?"],"¬°Buen viaje!"], sugerencias: ["Quiero alquilar una autocaravana en julio.","Mi madre conducir√° porque yo no tengo carn√© todav√≠a.","Ella ha conducido por la derecha 20 a√±os y es muy cuidadosa.","Queremos ir a Castilla-La Mancha para ver la tierra de Cervantes.","Me gusta mucho la libertad de dormir en cualquier sitio.",""]},
        4: { context: "Pl√°sticos.", prompts: ["1. Ban.","2. Oceans.","3. Biodegradable.","4. Citizens.","5. Answer question.","Fin."], dialogs: ["¬øPor qu√© est√°s tan contento?","¬øEs buena idea prohibirlos?","¬øHay alternativas al pl√°stico?","¬øQu√© m√°s podemos hacer los ciudadanos?",["¬øReciclas en casa?","¬øQu√© opinas del cambio clim√°tico?"],"¬°Muy bien!"], sugerencias: ["La UE ha acordado prohibir los pl√°sticos de un solo uso.","Es vital porque el pl√°stico es un problema serio en los oc√©anos.","Podemos usar materiales biodegradables o papel.","Debemos ser m√°s responsables y usar menos el coche.","S√≠, en mi casa reciclamos todo el pl√°stico y el papel.",""]},
        5: { context: "Aver√≠a coche AP-6.", prompts: ["1. Broken down.","2. Exit 156.","3. Replacement.","4. Red SEAT.","5. Answer question.","Fin."], dialogs: ["Hola, seguros. ¬øQu√© ha pasado?","¬øVes alguna se√±al cerca?","Enviamos una gr√∫a inmediatamente.","¬øC√≥mo es el coche exactamente?",["¬øSabes cambiar ruedas?","¬øHas esperado mucho?"],"¬°Llegamos en 15 minutos!"], sugerencias: ["Mi coche se ha averiado en la AP-6 hace un rato.","Veo la se√±al 156. ¬øPuede enviarme un mec√°nico?","¬øPueden darme un coche de sustituci√≥n para ir a Lugo?","Es un SEAT Ibiza rojo que era de mi t√≠a.","No, no s√© cambiar ruedas y no tengo herramientas.",""]}
    };

    function setInputEnabled(enabled) {
        document.getElementById('userInput').disabled = !enabled;
        document.getElementById('sendBtn').disabled = !enabled;
        document.getElementById('feedbackBtn').style.display = enabled ? "block" : "none";
        if(enabled) { document.getElementById('userInput').focus(); }
    }

    function seleccionarRP(id) {
        rpActual = id; pasoActual = 0; speaking = false;
        window.speechSynthesis.cancel();
        document.querySelectorAll('.rp-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('b' + id).classList.add('active');
        document.getElementById('candidate-card').style.display = "block";
        document.getElementById('card-context').innerHTML = database[id].context;
        document.getElementById('current-prompt').innerHTML = "Tap the RED BUTTON to hear the Examiner.";
        document.getElementById('chat').innerHTML = "";
        document.getElementById('next-trigger').style.display = "block";
        setInputEnabled(false);
    }

    function mostrarSugerencia() {
        if(!rpActual) return;
        const sug = database[rpActual].sugerencias[pasoActual];
        if(sug) {
            const fb = document.createElement('div');
            fb.className = 'feedback-box';
            fb.innerHTML = `üí° <b>Model:</b> ${sug}`;
            document.getElementById('chat').appendChild(fb);
            document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
        }
    }

    function enviarRespuesta() {
        if (!rpActual || speaking) return;
        const input = document.getElementById('userInput');
        const texto = input.value.trim();
        if (!texto) return;
        document.getElementById('chat').innerHTML += `<div class="bubble st">${texto}</div>`;
        input.value = "";
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
        setInputEnabled(false);
        pasoActual++; 
        setTimeout(() => { document.getElementById('next-trigger').style.display = "block"; }, 300);
    }

    function reproducirAudio(path, text) {
        window.speechSynthesis.cancel();
        const audio = new Audio(path);
        audio.play().then(() => {
            audio.onended = () => { speaking = false; if(pasoActual < database[rpActual].dialogs.length - 1) setInputEnabled(true); };
        }).catch(() => {
            const m = new SpeechSynthesisUtterance(text);
            m.lang = 'es-ES'; m.rate = 0.9;
            m.onend = () => { speaking = false; if(pasoActual < database[rpActual].dialogs.length - 1) setInputEnabled(true); };
            window.speechSynthesis.speak(m);
        });
    }

    function proximaIntervencion() {
        if (!rpActual || speaking) return;
        document.getElementById('next-trigger').style.display = "none";
        speaking = true;

        let t = database[rpActual].dialogs[pasoActual];
        let audioPath = "";

        if (Array.isArray(t)) {
            let idx = Math.floor(Math.random() * t.length);
            t = t[idx];
            audioPath = `rp${rpActual}_5${['a','b','c'][idx]}.mp3`;
        } else {
            audioPath = `rp${rpActual}_${pasoActual + 1}.mp3`;
        }

        const bubble = document.createElement('div');
        bubble.className = "bubble ex";
        bubble.innerHTML = `<b>Ex:</b> ${t}`;
        bubble.onclick = () => { reproducirAudio(audioPath, t); };
        
        document.getElementById('chat').appendChild(bubble);
        document.getElementById('current-prompt').innerHTML = `<b>Prompt:</b> ${database[rpActual].prompts[pasoActual]}`;
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;

        reproducirAudio(audioPath, t);
    }
</script>
</body>
</html>
