<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SEC Role Play Simulator</title>
    <style>
        :root { 
            --snap-yellow: #FFFC00; 
            --snap-ghost: #ffffff;
            --snap-black: #000000;
            --snap-blue: #00b9ff;
            --bg-gray: #f0f0f0;
            --shadow: 0 8px 24px rgba(0,0,0,0.1);
        }
        
        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; background: var(--bg-gray); }
        body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; display: flex; flex-direction: column; }
        
        /* Modal estilo Snapchat */
        #modal-instrucciones { 
            position: fixed; top:0; left:0; width:100%; height:100%; 
            background: var(--snap-yellow); display:flex; align-items:center; 
            justify-content:center; z-index:9999; padding: 20px; box-sizing: border-box; 
        }
        .modal-content { 
            background: white; padding: 30px; border-radius: 30px; max-width: 400px; 
            width: 100%; text-align: center; box-shadow: var(--shadow);
        }
        .btn-close { 
            display: block; width: 100%; background: var(--snap-black); color: white; 
            padding: 16px; border: none; border-radius: 50px; cursor: pointer; 
            margin-top: 25px; font-weight: bold; font-size: 1.1em; text-transform: uppercase;
        }

        header { 
            background: white; color: var(--snap-black); padding: 15px; text-align: center; 
            flex-shrink: 0; border-bottom: 2px solid var(--snap-yellow);
        }
        header h1 { margin: 0; font-size: 1.2em; font-weight: 800; text-transform: uppercase; }
        .sub-header { font-size: 0.75em; color: #666; font-weight: 500; margin-top: 2px; line-height: 1.2; padding: 0 10px; }
        .author-credit { font-size: 0.7em; color: var(--snap-blue); margin-top: 8px; font-weight: bold; }
        
        .selector { 
            display: flex; overflow-x: auto; gap: 8px; padding: 10px; 
            background: #fafafa; flex-shrink: 0; scrollbar-width: none;
        }
        .selector::-webkit-scrollbar { display: none; }
        
        .rp-btn { 
            min-width: 120px; padding: 8px 15px; background: white; 
            border: 2px solid #eee; border-radius: 20px; font-size: 13px; 
            font-weight: bold; cursor: pointer; transition: 0.2s; white-space: nowrap;
        }
        .active { border-color: var(--snap-yellow); background: var(--snap-yellow); color: black; }
        
        #candidate-card { 
            background: white; border-radius: 20px; padding: 15px; 
            margin: 10px 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); flex-shrink: 0; position: relative;
        }
        .card-context { font-weight: 800; color: var(--snap-blue); font-size: 0.7em; text-transform: uppercase; }
        .current-prompt { color: #333; font-size: 0.95em; margin-top: 5px; font-weight: 500; padding-right: 35px; line-height: 1.3;}
        
        #chat { 
            flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; 
            flex-direction: column; gap: 10px; background: white;
            margin: 0 10px; border-radius: 20px 20px 0 0;
            -webkit-overflow-scrolling: touch;
        }
        .bubble { 
            max-width: 75%; padding: 12px 16px; border-radius: 22px; 
            font-size: 15px; line-height: 1.4; position: relative;
        }
        .ex { align-self: flex-start; background: #f0f0f0; color: black; border-bottom-left-radius: 4px; cursor: pointer; }
        .st { align-self: flex-end; background: var(--snap-blue); color: white; border-bottom-right-radius: 4px; }

        .feedback-box { 
            font-size: 0.85em; background: #fffceb; color: #856404; padding: 12px; 
            border-radius: 15px; border: 1px dashed #ffeeba; align-self: center; width: 90%; text-align: center; margin: 5px 0;
        }
        
        #next-trigger { 
            display: none; margin: 10px auto; padding: 14px; background: #ff004b; 
            color: white; border: none; border-radius: 50px; font-weight: bold; 
            cursor: pointer; width: 80%; font-size: 15px; text-transform: uppercase;
            box-shadow: 0 4px 12px rgba(255, 0, 75, 0.3); flex-shrink: 0;
        }

        .input-area { background: white; padding: 10px 15px 30px; display: flex; gap: 8px; align-items: center; flex-shrink: 0; }
        input { 
            flex: 1; padding: 12px 18px; border-radius: 25px; border: none; 
            background: #f0f0f0; font-size: 16px; outline: none; -webkit-appearance: none;
        }
        .btn-send { background: var(--snap-blue); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        
        .btn-feedback { 
            position: absolute; right: 12px; top: 12px; background: #eee; 
            border: none; border-radius: 50%; width: 30px; height: 30px; font-weight: bold; cursor: pointer;
        }
    </style>
</head>
<body>

<div id="modal-instrucciones">
    <div class="modal-content">
        <h1 style="margin-bottom:10px; font-size: 1.8em;">SEC Simulator</h1>
        <p style="color:#666; font-size: 0.95em; line-height: 1.5;">
            <b>Interactive training for the Leaving Cert Spanish Role Play section.</b><br><br>
            1. Pick a scenario.<br>
            2. Hear the Examiner (Red Button).<br>
            3. Type or use your Mic to reply.<br>
            4. Use "?" if you need a hint.
        </p>
        <button class="btn-close" onclick="startApp()">Let's go!</button>
    </div>
</div>

<header>
    <h1>SEC Role Play Simulator</h1>
    <div class="sub-header">Interactive training for the Leaving Cert Spanish Role Play section</div>
    <div class="author-credit">Developed by Sr. Mart√≠n</div>
</header>

<div class="selector">
    <div class="rp-btn" onclick="seleccionarRP(1, this)">üè† 1. Alojamiento</div>
    <div class="rp-btn" onclick="seleccionarRP(2, this)">üíª 2. Port√°til</div>
    <div class="rp-btn" onclick="seleccionarRP(3, this)">üöê 3. Camper van</div>
    <div class="rp-btn" onclick="seleccionarRP(4, this)">‚ôªÔ∏è 4. Pl√°sticos</div>
    <div class="rp-btn" onclick="seleccionarRP(5, this)">üöó 5. Aver√≠a</div>
</div>

<div id="candidate-card" style="display:none">
    <div class="card-context" id="card-context"></div>
    <div class="current-prompt" id="current-prompt">Ready!</div>
    <button class="btn-feedback" id="feedbackBtn" onclick="mostrarSugerencia()" style="display:none">?</button>
</div>

<div id="chat"></div>
<button id="next-trigger" onclick="proximaIntervencion()">Press to listen üîä</button>

<div class="input-area">
    <input type="text" id="userInput" placeholder="Select a Role Play..." disabled>
    <button class="btn-send" id="sendBtn" onclick="enviarRespuesta()" disabled>‚û§</button>
</div>

<script>
    let rpActual = null; 
    let pasoActual = 0; 
    let speaking = false;

    const database = {
        1: {
            context: "ERASMUS en C√°ceres. Llamas por alojamiento.",
            prompts: ["1. ERASMUS next year. Ask for advice.", "2. Near uni (Dublin outskirts experience).", "3. Travelling too long. Study = good grades.", "4. Better climate. All areas ok but prefer center.", "5. Respond to the surprise question.", "Fin."],
            dialogs: ["¬°Hola, d√≠game!", "¬øEn qu√© parte de la ciudad querr√≠as vivir?", "¬øPor qu√©?", "Tienes raz√≥n. Pero sabes que C√°ceres es una ciudad muy peque√±a... ", ["¬øHas estado alguna vez en Espa√±a?", "¬øQu√© es lo que m√°s te gusta de Espa√±a?", "¬øPor qu√© estudiar en Espa√±a?"], "Hemos terminado, gracias"],
            sugerencias: ["Hola, voy a ir de ERASMUS el a√±o que viene. No conozco a nadie en C√°ceres ¬øPodr√≠a darme alg√∫n consejo sobre el alojamiento?", "Preferir√≠a vivir cerca de la universidad porque el a√±o pasado viv√≠ en las afueras de Dubl√≠n y no me gust√≥.", "Pues es que pasaba demasiado tiempo viajando. Si pudiera dedicar ese tiempo a estudiar, sacar√≠a mejores notas.", "Bueno, el clima es mucho mejor que en Irlanda, as√≠ que considerar√© todas las zonas aunque preferir√≠a el centro.", "(Respuesta libre...)", ""]
        },
        2: { 
            context: "You are in √Åvila and your laptop is broken.", 
            prompts: ["1. Laptop fell and screen is broken. Essay due tomorrow.", "2. Late for bus, slipped, only noticed when got up.", "3. Good it can be fixed. Same model in window costs 300‚Ç¨.", "4. Will buy if files are copied and get a free bag.", "5. Answer the examiner's question.", "Fin."], 
            dialogs: ["¬°Hola! ¬øEn qu√© puedo ayudarte?", "Vamos a ver. ¬øQu√© te pas√≥?", "Vas a necesitar una nueva pantalla que cuesta doscientos euros.", "S√≠, hay una oferta especial esta semana. ¬øQuieres comprarlo?", ["¬øDe qu√© marca es tu ordenador?","¬øPara qu√© usas el ordenador normalmente?","¬øDe qu√© color te gustar√≠a la funda del ordenador?"], "Hemos terminado, gracias"], 
            sugerencias: ["Se me cay√≥ el port√°til y la pantalla est√° rota. Lo peor es que tengo que entregar un ensayo ma√±ana y la √∫nica copia que tengo est√° en mi port√°til.", "Llegaba tarde y tuve que correr para coger el autob√∫s. Me resbal√© y el port√°til se cay√≥ al suelo y me di cuenta del problema en cuanto me levant√©.", "Es bueno saber que tiene arreglo pero he visto un port√°til del mismo modelo y la misma marca a la venta en el escaparate y solo cuesta trescientos euros.", "Lo comprar√© si puedes copiar todos mis archivos al nuevo disco duro antes de salir de la tienda y si me das un bolso gratis para el port√°til.", "(Respuesta libre...)", ""]
        },
        3: { 
            context: "You are going to Spain on holidays and your family is thinking of hiring a camper van.", 
            prompts: ["1. Student calling from Ireland. Hire for 2 weeks in July.", "2. Mother driving. You are getting lessons, hope to pass in Autumn.", "3. She has driven on the right in Europe for 20 years. Careful driver.", "4. Coastal experience. Want to see land of Cervantes far from tourists.", "5. Respond to the surprise question.", "Fin."], 
            dialogs: ["¬°Hola! ¬øEn qu√© puedo ayudarte?", "Para alquilar un c√°mper hace falta tener al menos veinticinco a√±os y mucha experiencia al volante.", "Pues, muy bien. Tu madre cumple con los requisitos para alquilar un c√°mper.", "¬°Fenomenal! Os alquilo un c√°mper. ¬øTen√©is el itinerario previsto?", ["¬øA qu√© hora vais a recoger el c√°mper?", "¬øQu√© tipo de m√∫sica os gusta escuchar en el coche?", "¬øQu√© ciudades te gustar√≠a visitar en vuestro viaje?"], "Hemos terminado, gracias"], 
            sugerencias: ["Soy estudiante y llamo desde Irlanda, me interesa alquilar un c√°mper durante dos semanas en julio.", "Mi madre va a conducir porque yo todav√≠a no tengo el carn√© de conducir. Estoy yendo a clases de conducir y espero aprobar el examen en oto√±o.", "Ha conducido por la derecha en varios pa√≠ses europeos durante los √∫ltimos veinte a√±os. Es una conductora muy prudente y nunca ha tenido un accidente.", "Hemos pasado mucho tiempo en la costa, pero este verano nos gustar√≠a viajar por Castilla-La Mancha para ver la tierra de Cervantes y Don Quijote, lejos de los turistas.", "(Respuesta libre...)", ""]
        },
        4: { 
            context: "Pollution of the planet by single use plastics.", 
            prompts: ["1. EU agreed to ban single use plastics (knives, straws, etc).", "2. Essential for waters. Serious problem in rivers and oceans.", "3. Use recycled paper, cardboard and biodegradable materials.", "4. Be responsible. Cycle, use public transport or walk more.", "5. Respond to the surprise question.", "Fin."], 
            dialogs: ["Pareces muy contento, ¬øpor qu√©?", "¬øEs importante prohibir pl√°sticos de usar y tirar?", "¬øPodemos hacer algo m√°s?", "Y, ¬øya est√°?", ["¬øQu√© cosas reciclas t√∫ en tu casa?", "¬øQu√© haces t√∫ para ayudar al medioambiente?", "¬øQu√© transporte usas para venir al instituto?"], "Hemos terminado, gracias"], 
            sugerencias: ["El Parlamento Europeo ha convenido prohibir los pl√°sticos de un solo uso, por ejemplo, los cuchillos, los tenedores, las cucharas, las tazas, los platos y las pajitas.", "S√≠, es absolutamente imprescindible. Ser√° muy bueno para las aguas del planeta. La contaminaci√≥n causada por los pl√°sticos es un problema grave en r√≠os, lagos y oc√©anos.", "Hay muchas cosas que podemos hacer. Por ejemplo, en vez de usar pl√°sticos, podemos usar papel reciclado, cart√≥n y otros materiales biodegradables.", "No, como ciudadanos necesitamos ser m√°s responsables y cambiar nuestro estilo de vida. Para proteger el medio ambiente podr√≠amos ir en bicicleta, usar el transporte p√∫blico o caminar m√°s a menudo.", "(Respuesta libre...)", ""]
        },
        5: { 
            context: "Driving from Madrid to Lugo on the AP-6 and car has stopped. Call insurance.", 
            prompts: ["1. Car broken down on AP-6. Passed toll half an hour ago.", "2. See exit sign 156. Send mechanic or tow truck.", "3. Replacement car for journey to Lugo to collect parents.", "4. Red Seat Ibiza. 4620 CFK. Bought from aunt.", "5. Respond to the surprise question.", "Fin."], 
            dialogs: ["Hola, buenas tardes.", "Debes estar entre Medina del Campo y Tordesillas. ¬øHay alguna se√±al de tr√°fico por ah√≠?", "Claro que s√≠. Voy a arreglarlo todo inmediatamente.", "Por supuesto. ¬øMe puedes describir tu coche?", ["¬øCu√°ntas personas viajan contigo en el coche?", "¬øQu√© ciudades te gustar√≠a visitar?", "¬øCu√°nto cost√≥ el coche?"], "Hemos terminado, gracias"], 
            sugerencias: ["Mi coche acaba de averiarse y estoy en la autopista AP-6. No s√© exactamente donde estoy pero pas√© por el peaje hace media hora.", "Puedo ver la se√±al de salida 156 a lo lejos. ¬øPueden enviar un mec√°nico o quiz√°s una gr√∫a? Es que creo que el problema es serio.", "¬øPodr√≠an darme un coche de sustituci√≥n para que pueda seguir mi viaje a Lugo? Tengo que recoger a mis padres en el aeropuerto de Santiago de Compostela.", "Es un Seat Ibiza rojo. La matr√≠cula es 4620 CFK. Se lo compr√© de segunda mano a mi t√≠a y nunca he tenido un problema con √©l antes.", "(Respuesta libre...)", ""]
        }
    };

    function startApp() { 
        new Audio().play().catch(()=>{}); 
        document.getElementById('modal-instrucciones').style.display = 'none'; 
    }

    function setInputEnabled(e) { 
        const input = document.getElementById('userInput');
        input.disabled = !e; 
        document.getElementById('sendBtn').disabled = !e; 
        document.getElementById('feedbackBtn').style.display = e ? "block" : "none"; 
        input.placeholder = e ? "Type or use Mic to reply..." : "Listening..."; 
        if(e) input.focus();
    }

    function seleccionarRP(id, btn) { 
        rpActual = id; 
        pasoActual = 0; 
        speaking = false;
        document.querySelectorAll('.rp-btn').forEach(b => b.classList.remove('active')); 
        btn.classList.add('active'); 
        document.getElementById('candidate-card').style.display = "block"; 
        document.getElementById('card-context').innerHTML = database[id].context; 
        document.getElementById('chat').innerHTML = ""; 
        document.getElementById('current-prompt').innerHTML = "Tap the RED BUTTON to start."; 
        document.getElementById('next-trigger').style.display = "block"; 
        setInputEnabled(false); 
    }

    function mostrarSugerencia() { 
        const sug = database[rpActual]?.sugerencias[pasoActual]; 
        if(sug) { 
            const fb = document.createElement('div'); 
            fb.className = 'feedback-box'; 
            fb.innerHTML = `üí° <b>Model Hint:</b> ${sug}`; 
            document.getElementById('chat').appendChild(fb); 
            document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight; 
        } 
    }

    function enviarRespuesta() { 
        const input = document.getElementById('userInput'); 
        const text = input.value.trim(); 
        if (!text || speaking) return; 
        document.getElementById('chat').innerHTML += `<div class="bubble st">${text}</div>`; 
        input.value = ""; 
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight; 
        setInputEnabled(false); 
        pasoActual++; 
        setTimeout(() => { 
            document.getElementById('next-trigger').style.display = "block"; 
        }, 300); 
    }

    function reproducirAudio(path, fallbackText) { 
        window.speechSynthesis.cancel(); 
        const audio = new Audio(path); 
        
        const onEndAction = () => { 
            speaking = false; 
            if(pasoActual < (database[rpActual].dialogs.length - 1)) {
                setInputEnabled(true); 
            }
        }; 

        audio.play()
            .then(() => { audio.onended = onEndAction; })
            .catch(() => { 
                const msg = new SpeechSynthesisUtterance(fallbackText); 
                msg.lang = 'es-ES'; 
                msg.onend = onEndAction; 
                window.speechSynthesis.speak(msg); 
            }); 
    }

    function proximaIntervencion() { 
        if (!rpActual || speaking) return; 
        document.getElementById('next-trigger').style.display = "none"; 
        speaking = true; 
        
        let dialogText = database[rpActual].dialogs[pasoActual]; 
        let audioFile = ""; 
        
        if (Array.isArray(dialogText)) { 
            let randomIndex = Math.floor(Math.random() * dialogText.length); 
            dialogText = dialogText[randomIndex]; 
            audioFile = `rp${rpActual}_5${['a','b','c'][randomIndex]}.mp3`; 
        } else { 
            audioFile = `rp${rpActual}_${pasoActual + 1}.mp3`; 
        } 
        
        const chat = document.getElementById('chat');
        const bubble = document.createElement('div'); 
        bubble.className = "bubble ex"; 
        bubble.innerHTML = `<b>Examiner:</b> ${dialogText}`; 
        bubble.onclick = () => reproducirAudio(audioFile, dialogText); 
        
        chat.appendChild(bubble); 
        document.getElementById('current-prompt').innerHTML = `<b>Prompt:</b> ${database[rpActual].prompts[pasoActual]}`; 
        chat.scrollTop = chat.scrollHeight; 
        
        reproducirAudio(audioFile, dialogText); 
    }
</script>
</body>
</html>
