<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LC Oral Master - Se√±or Mart√≠n</title>
    <style>
        :root { --primary: #1a237e; --secondary: #c62828; }
        body { font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background: #e5ddd5; }
        header { background: var(--primary); color: white; padding: 15px; text-align: center; flex-shrink: 0; font-weight: bold; }
        .selector { display: flex; overflow-x: auto; gap: 8px; padding: 10px; background: #fff; border-bottom: 2px solid #ccc; flex-shrink: 0; }
        .rp-btn { min-width: 90px; padding: 10px; background: #f8f8f8; border: 1px solid #999; border-radius: 8px; font-size: 13px; text-align: center; cursor: pointer; }
        .active { background: var(--secondary) !important; color: white; }
        #chat { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .bubble { max-width: 80%; padding: 12px; border-radius: 12px; font-size: 16px; line-height: 1.4; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .ex { align-self: flex-start; background: white; }
        .st { align-self: flex-end; background: #dcf8c6; }
        .input-area { background: white; padding: 15px 15px 40px 15px; display: flex; gap: 10px; border-top: 2px solid var(--primary); }
        input { flex: 1; padding: 12px; border-radius: 20px; border: 1px solid #ccc; font-size: 17px; }
        .btn { background: var(--primary); color: white; border: none; padding: 10px 18px; border-radius: 50%; font-size: 20px; }
    </style>
</head>
<body>

<header>Se√±or Mart√≠n: Simulador Oficial SEC</header>

<div class="selector">
    <div class="rp-btn" id="b1" onclick="start(1)">üè† 1. C√°ceres</div>
    <div class="rp-btn" id="b2" onclick="start(2)">üíª 2. √Åvila</div>
    <div class="rp-btn" id="b3" onclick="start(3)">üöê 3. Caravana</div>
    <div class="rp-btn" id="b4" onclick="start(4)">‚ôªÔ∏è 4. Pl√°sticos</div>
    <div class="rp-btn" id="b5" onclick="start(5)">üöó 5. Aver√≠a</div>
</div>

<div id="chat"></div>

<div class="input-area">
    <button class="btn" id="mic" onclick="runMic()">üéôÔ∏è</button>
    <input type="text" id="box" placeholder="Responde al examinador...">
    <button class="btn" onclick="send()">‚ñ∂Ô∏è</button>
</div>

<script>
    let current = null; 
    let step = 0;

    const data = {
        1: [
            "¬°Hola, d√≠game!", 
            "Entiendo que vas a estudiar un a√±o en C√°ceres. ¬øEn qu√© parte de la ciudad querr√≠as vivir?", 
            "¬øPor qu√©?", 
            "Tienes raz√≥n, pero C√°ceres es peque√±a y se puede ir andando a la Plaza Mayor en media hora desde las afueras.",
            ["¬øHas estado alguna vez en C√°ceres?", "¬øQu√© es lo que m√°s te gusta de vivir en Espa√±a?", "¬øPor qu√© quieres estudiar en Espa√±a?"],
            "Hemos terminado, gracias."
        ],
        2: [
            "Buenos d√≠as. ¬øEn qu√© puedo ayudarte?", 
            "Veo que tienes un problema con el port√°til. ¬øQu√© le ha pasado exactamente a la pantalla?", 
            "¬°Qu√© mala suerte! Y ma√±ana es un d√≠a importante. ¬øTienes una copia de seguridad de tus archivos?", 
            "Mira, tengo una oferta: te lo puedo arreglar hoy mismo por trescientos euros. ¬øQu√© te parece?", 
            ["¬øUsas mucho el port√°til para tus estudios?", "¬øPrefieres Mac o Windows?", "¬øHas tenido problemas t√©cnicos antes?"],
            "Examen finalizado. ¬°Buen trabajo!"
        ],
        3: [
            "Hola, buenos d√≠as. ¬øQuieres alquilar una autocaravana?", 
            "¬øQui√©n va a conducir la caravana?", 
            "¬øTu madre ha tenido alg√∫n accidente √∫ltimamente?", 
            "Castilla-La Mancha es una zona preciosa. ¬øQu√© ciudades quer√©is visitar?", 
            ["¬øTe gusta acampar al aire libre?", "¬øPrefieres viajar en verano o en invierno?", "¬øHas conducido alguna vez un veh√≠culo grande?"],
            "Role Play completado."
        ],
        4: [
            "¬°Hola! Pareces muy contento/a. ¬øPor qu√©?", 
            "Es una noticia fant√°stica. ¬øSabes cu√°ndo entrar√° en vigor la prohibici√≥n del Parlamento Europeo?", 
            "Es verdad. ¬øQu√© materiales crees que se deber√≠an usar ahora?", 
            "En casa intentamos reciclar siempre. ¬øY t√∫?", 
            ["¬øCrees que tu colegio recicla lo suficiente?", "¬øQu√© opinas del cambio clim√°tico?", "¬øUsas botellas de cristal o de pl√°stico?"],
            "¬°Muy bien! Hemos terminado."
        ],
        5: [
            "¬°Hola, buenas tardes!", 
            "Debes estar entre Medina del Campo y Tordesillas, cerca de la salida ciento cincuenta y seis. ¬øVes alguna se√±al de tr√°fico por ah√≠?", 
            "Claro que s√≠. Voy a ayudarte inmediatamente. ¬øMe puedes describir tu coche?", 
            "¬øLlevas mucho tiempo esperando?", 
            ["¬øHas llamado ya a tu familia para avisar?", "¬øSabes cambiar una rueda t√∫ solo?", "¬øEs la primera vez que visitas esta zona?"],
            "El mec√°nico llegar√° pronto. ¬°Suerte!"
        ]
    };

    function playAudio(archivo, textoFallback) {
        let audio = new Audio(archivo);
        audio.play().catch(e => {
            console.log("Audio no encontrado, usando robot.");
            speak(textoFallback);
        });
    }

    function speak(txt) {
        window.speechSynthesis.cancel();
        let m = new SpeechSynthesisUtterance(txt);
        m.lang = 'es-ES';
        m.rate = 0.85;
        window.speechSynthesis.speak(m);
    }

    function start(id) {
        current = id; step = 0;
        document.querySelectorAll('.rp-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('b'+id).classList.add('active');
        document.getElementById('chat').innerHTML = "";
        next();
    }

    function next() {
        if (!current || step >= data[current].length) return;
        
        let t = data[current][step];
        let audioFile = "";

        // L√≥gica de aleatoriedad para preguntas sorpresa (Paso 4 en el √≠ndice 0)
        if (step === 4) {
            let opciones = ['a', 'b', 'c'];
            let rand = Math.floor(Math.random() * 3);
            t = data[current][step][rand];
            audioFile = `rp${current}_5${opciones[rand]}.m4a`;
        } else if (step === 5) {
            audioFile = `rp${current}_5.m4a`; // El cierre
        } else {
            audioFile = `rp${current}_${step + 1}.m4a`;
        }

        let c = document.getElementById('chat');
        c.innerHTML += `<div class="bubble ex"><b>Examinador:</b> ${t}</div>`;
        
        // Solo intenta audio si es RP1 (que es el que usted tiene grabado)
        // Para los dem√°s, usar√° el robot hasta que suba los audios
        if (current === 1) {
            playAudio(audioFile, t);
        } else {
            speak(t);
        }
        
        c.scrollTop = c.scrollHeight;
        step++;
    }

    function send() {
        let i = document.getElementById('box');
        if (!i.value) return;
        document.getElementById('chat').innerHTML += `<div class="bubble st">${i.value}</div>`;
        i.value = "";
        setTimeout(next, 1200);
    }

    function runMic() {
        let Reco = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!Reco) return alert("Micro no disponible");
        let r = new Reco(); r.lang = 'es-ES';
        r.onstart = () => document.getElementById('mic').style.background = 'red';
        r.onresult = (e) => {
            document.getElementById('box').value = e.results[0][0].transcript;
            document.getElementById('mic').style.background = '#1a237e';
            send();
        };
        r.onerror = () => document.getElementById('mic').style.background = '#1a237e';
        r.start();
    }
</script>
</body>
</html>
