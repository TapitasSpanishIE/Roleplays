<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SEC Practice - Sr. Mart√≠n</title>
    <style>
        :root { --primary: #2c3e50; --secondary: #e74c3c; --accent: #3498db; --light-bg: #ecf0f1; --feedback: #2980b9; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background: var(--light-bg); color: #333; }
        
        header { background: var(--primary); color: white; padding: 15px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .author-tag { font-size: 0.8em; color: #3498db; font-weight: bold; display: block; margin-top: 5px; text-transform: uppercase; letter-spacing: 1px; }
        .disclaimer { font-size: 0.7em; color: #bdc3c7; font-weight: normal; }

        .selector { display: flex; overflow-x: auto; gap: 10px; padding: 12px; background: #fff; border-bottom: 1px solid #ddd; flex-shrink: 0; }
        .rp-btn { min-width: 110px; padding: 10px; background: #fff; border: 2px solid #ddd; border-radius: 8px; font-size: 13px; cursor: pointer; text-align: center; transition: 0.3s; }
        .active { border-color: var(--secondary); background: #fdf2f2; font-weight: bold; color: var(--secondary); transform: scale(1.05); }
        
        #candidate-card { background: #fffde7; border-left: 5px solid #f1c40f; padding: 15px; margin: 10px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: relative; min-height: 60px; }
        .card-context { font-style: italic; color: #7f8c8d; margin-bottom: 10px; border-bottom: 1px solid #e1e1e1; padding-bottom: 8px; font-size: 0.85em; line-height: 1.3; }
        .current-prompt { font-weight: bold; color: #2c3e50; background: #fdf9c4; padding: 5px; border-radius: 3px; font-size: 0.95em; padding-right: 45px; }
        
        .btn-feedback { position: absolute; right: 8px; bottom: 8px; background: var(--feedback); color: white; border: none; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; font-weight: bold; font-size: 18px; display: none; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }

        #chat { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .bubble { max-width: 85%; padding: 12px 16px; border-radius: 18px; font-size: 16px; line-height: 1.4; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .ex { align-self: flex-start; background: white; border: 1px solid #dee2e6; border-bottom-left-radius: 2px; }
        .st { align-self: flex-end; background: #dcf8c6; border-bottom-right-radius: 2px; }
        .feedback-text { font-size: 0.85em; color: var(--feedback); font-style: italic; margin: 5px 0; background: #e1f5fe; padding: 10px; border-radius: 8px; border-left: 4px solid var(--feedback); align-self: center; width: 90%; }

        #next-trigger { display: none; margin: 10px auto; padding: 14px 24px; background: var(--secondary); color: white; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; width: 85%; font-size: 16px; box-shadow: 0 4px 12px rgba(231,76,60,0.3); }

        .input-area { background: white; padding: 15px 15px 35px 15px; display: flex; gap: 10px; border-top: 1px solid #ddd; }
        input { flex: 1; padding: 12px 18px; border-radius: 25px; border: 1px solid #ccc; font-size: 16px; outline: none; }
        .btn-send { background: var(--accent); color: white; border: none; width: 48px; height: 48px; border-radius: 50%; font-size: 20px; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<header>
    SEC Spanish Oral Practice
    <span class="author-tag">Created by Sr. Mart√≠n</span>
    <span class="disclaimer">Based on official Leaving Certificate Role Plays</span>
</header>

<div class="selector">
    <div class="rp-btn" id="b1" onclick="seleccionarRP(1)">üè† 1. Alojamiento</div>
    <div class="rp-btn" id="b2" onclick="seleccionarRP(2)">üíª 2. Port√°til</div>
    <div class="rp-btn" id="b3" onclick="seleccionarRP(3)">üöê 3. Camper van</div>
    <div class="rp-btn" id="b4" onclick="seleccionarRP(4)">‚ôªÔ∏è 4. Pl√°sticos</div>
    <div class="rp-btn" id="b5" onclick="seleccionarRP(5)">üöó 5. Aver√≠a</div>
</div>

<div id="candidate-card" style="display:none;">
    <div class="card-context" id="card-context"></div>
    <div class="current-prompt" id="current-prompt"></div>
    <button class="btn-feedback" id="feedbackBtn" onclick="mostrarSugerencia()" title="Get help">?</button>
</div>

<div id="chat"></div>
<button id="next-trigger" onclick="proximaIntervencion()">Tap to hear Examiner ‚è©</button>

<div class="input-area">
    <input type="text" id="userInput" placeholder="Select a scenario..." disabled>
    <button class="btn-send" id="sendBtn" onclick="enviarRespuesta()" disabled>‚ñ∂Ô∏è</button>
</div>

<script>
    let rpActual = null;
    let pasoActual = 0;
    let speaking = false;

    const database = {
        1: {
            context: "You are going on Erasmus to Caceres and need accommodation advice.",
            prompts: [
                "Say you will be on ERASMUS next year. Ask for accommodation advice.",
                "Say you prefer to live near the university (Dublin outskirts experience).",
                "Say you spent too much time travelling. Mention grades/studying.",
                "Say the climate is better than in Ireland. You'll consider all areas.",
                "Respond to the examiner's question.",
                "Role Play finished."
            ],
            dialogs: ["¬°Hola, d√≠game!", "¬øEn qu√© parte de la ciudad querr√≠as vivir?", "¬øPor qu√©?", "Tienes raz√≥n. Pero sabes que C√°ceres es una ciudad muy peque√±a y se puede andar desde las afueras a la Plaza Mayor en media hora.", ["¬øHas estado alguna vez en Espa√±a?", "¬øPrefieres piso o residencia?"], "¬°Mucha suerte en C√°ceres!"],
            sugerencias: [
                "Hola, voy a ir de ERASMUS el pr√≥ximo a√±o acad√©mico. No conozco a nadie en C√°ceres, ¬øpodr√≠a darme alg√∫n consejo sobre el alojamiento?",
                "Preferir√≠a vivir cerca de la universidad porque el a√±o pasado viv√≠ en las afueras de Dubl√≠n y no me gust√≥ nada.",
                "Pasaba demasiado tiempo viajando. Si pudiera dedicar ese tiempo a estudiar, sacar√≠a mejores notas.",
                "Eso no est√° lejos y el clima es mucho mejor que en Irlanda, as√≠ que considerar√© todas las zonas.",
                "Respuesta libre (ej: S√≠, estuve en Madrid hace dos a√±os...)",
                ""
            ]
        },
        2: {
            context: "Your laptop is broken and you take it to a repair shop in Avila.",
            prompts: [
                "Say screen is broken. Essay due tomorrow (only copy).",
                "Late for bus, slipped and fell.",
                "It can be fixed but you saw same model for 300‚Ç¨ in window.",
                "Buy it if they copy files and give free bag.",
                "Respond to the examiner's question.",
                "Examen finalizado."
            ],
            dialogs: ["¬°Hola! ¬øEn qu√© puedo ayudarte?", "Vamos a ver. ¬øQu√© le pas√≥?", "Necesitas una nueva pantalla. Cuesta 200 euros.", "Hay una oferta especial esta semana. ¬øQuieres comprarlo?", ["¬øUsas mucho el ordenador?", "¬øQu√© marca es?"], "¬°Listo!"],
            sugerencias: [
                "Hola, se me ha ca√≠do el port√°til y la pantalla est√° rota. Tengo un ensayo para ma√±ana y la √∫nica copia est√° aqu√≠.",
                "Llegaba tarde al autob√∫s, me resbal√© y el port√°til se cay√≥ al suelo.",
                "Qu√© bien que se pueda arreglar, pero he visto el mismo modelo en el escaparate por 300 euros.",
                "Lo comprar√© si pueden copiar mis archivos y si me dan un malet√≠n gratis.",
                "Respuesta libre (ej: S√≠, lo uso todos los d√≠as para mis estudios...)",
                ""
            ]
        },
        3: {
            context: "Hiring a camper van for two weeks in July.",
            prompts: ["Irish student, hire camper for 2 weeks in July.", "Mother driving (no licence yet, taking lessons).", "She has driven on the right for 20 years. Careful driver.", "Travel through Castilla-La Mancha (Cervantes).", "Respond to the examiner.", "Fin."],
            dialogs: ["¬°Hola! ¬øEn qu√© puedo ayudarte?", "Hace falta tener 25 a√±os para conducir.", "Muy bien. Tu madre cumple los requisitos.", "¬°Fenomenal! ¬øTen√©is el itinerario previsto?", ["¬øTe gusta acampar?", "¬øMar o monta√±a?"], "¬°Buen viaje!"],
            sugerencias: [
                "Hola, soy un estudiante de Irlanda y estoy interesado en alquilar una autocaravana dos semanas en julio.",
                "Mi madre conducir√° porque yo no tengo carn√© todav√≠a. Estoy recibiendo clases.",
                "Ella ha conducido por la derecha en Europa durante 20 a√±os y es una conductora muy cuidadosa.",
                "Esperamos viajar por Castilla-La Mancha para ver la tierra de Cervantes, lejos de los turistas.",
                "Respuesta libre (ej: Prefiero la monta√±a porque es m√°s tranquila...)",
                ""
            ]
        },
        4: {
            context: "Plastic pollution news.",
            prompts: ["EU ban on single use plastics.", "Essential for waters. Serious problem in rivers/oceans.", "Recycled paper or biodegradable materials.", "Citizens responsibility (cycle/walk).", "Respond to examiner.", "Fin."],
            dialogs: ["Pareces muy contento, ¬øpor qu√©?", "¬øEs importante prohibir pl√°sticos?", "¬øPodemos hacer algo m√°s?", "¬øY ya est√°?", ["¬øTu colegio recicla?", "¬øQu√© opinas del cambio clim√°tico?"], "¬°Muy bien!"],
            sugerencias: [
                "El Parlamento Europeo ha acordado prohibir los pl√°sticos de un solo uso como cuchillos y pajitas.",
                "Es esencial y ser√° bueno para el agua. El pl√°stico es un problema serio en r√≠os y oc√©anos.",
                "Hay muchas cosas que podemos hacer, como usar papel reciclado o materiales biodegradables.",
                "No, los ciudadanos necesitan ser m√°s responsables. Podr√≠amos ir en bici o caminar m√°s.",
                "Respuesta libre (ej: S√≠, en mi colegio reciclamos papel y pl√°stico...)",
                ""
            ]
        },
        5: {
            context: "Car breakdown on AP-6.",
            prompts: ["Broken down on AP-6. Passed toll 30 mins ago.", "Exit sign 156. Ask for mechanic/tow truck.", "Replacement car (Lugo, collect parents).", "Red SEAT Ibiza (4620 CFK). Bought from aunt.", "Respond to examiner.", "Fin."],
            dialogs: ["Hola, buenas tardes.", "¬øHay alguna se√±al de tr√°fico?", "Voy a arreglarlo todo.", "¬øMe puedes describir tu coche?", ["¬øSabes cambiar una rueda?", "¬øLlevas mucho esperando?"], "¬°√Ånimo!"],
            sugerencias: [
                "Hola, mi coche se ha averiado en la autopista AP-6. Pas√© el peaje hace media hora.",
                "Veo la se√±al de salida 156. ¬øPodr√≠a enviarme un mec√°nico o una gr√∫a? Es serio.",
                "¬øPodr√≠a darme un coche de sustituci√≥n para ir a Lugo? Tengo que recoger a mis padres en el aeropuerto.",
                "Es un SEAT Ibiza rojo, matr√≠cula 4620 CFK. Se lo compr√© a mi t√≠a.",
                "Respuesta libre (ej: No, no s√© cambiarla, es muy dif√≠cil...)",
                ""
            ]
        }
    };

    function setInputEnabled(enabled) {
        const input = document.getElementById('userInput');
        const btn = document.getElementById('sendBtn');
        input.disabled = !enabled;
        btn.disabled = !enabled;
        input.placeholder = enabled ? "Escribe en espa√±ol..." : "Esperando...";
        document.getElementById('feedbackBtn').style.display = enabled ? "block" : "none";
    }

    function seleccionarRP(id) {
        rpActual = id; pasoActual = 0; speaking = false;
        window.speechSynthesis.cancel();
        document.querySelectorAll('.rp-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('b' + id).classList.add('active');
        document.getElementById('candidate-card').style.display = "block";
        document.getElementById('card-context').innerHTML = database[id].context;
        document.getElementById('current-prompt').innerHTML = "Click the RED BUTTON to begin.";
        document.getElementById('chat').innerHTML = "";
        document.getElementById('next-trigger').style.display = "block";
        setInputEnabled(false);
    }

    function mostrarSugerencia() {
        const sug = database[rpActual].sugerencias[pasoActual];
        if(sug) {
            document.getElementById('chat').innerHTML += `<div class="feedback-text">üí° <b>Model Answer:</b> ${sug}</div>`;
            document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
        }
    }

    function enviarRespuesta() {
        if (!rpActual || speaking) return;
        const input = document.getElementById('userInput');
        const texto = input.value.trim();
        if (!texto) return;
        window.speechSynthesis.speak(new SpeechSynthesisUtterance("")); 
        document.getElementById('chat').innerHTML += `<div class="bubble st">${texto}</div>`;
        input.value = "";
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
        setInputEnabled(false);
        setTimeout(() => { document.getElementById('next-trigger').style.display = "block"; }, 500);
    }

    function proximaIntervencion() {
        if (!rpActual || speaking) return;
        document.getElementById('next-trigger').style.display = "none";
        speaking = true;
        let t = database[rpActual].dialogs[pasoActual];
        let audioPath = "";

        if (Array.isArray(t)) {
            let index = Math.floor(Math.random() * t.length);
            t = t[index];
            audioPath = `rp${rpActual}_5${['a','b','c'][index]}.mp3`;
        } else {
            audioPath = `rp${rpActual}_${pasoActual + 1}.mp3`;
        }

        document.getElementById('chat').innerHTML += `<div class="bubble ex"><b>Examinador:</b> ${t}</div>`;
        document.getElementById('current-prompt').innerHTML = `<b>Prompt:</b> ${database[rpActual].prompts[pasoActual]}`;
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;

        const finalizarTurno = () => {
            speaking = false;
            pasoActual++;
            if (pasoActual < database[rpActual].dialogs.length) setInputEnabled(true);
        };

        const audio = new Audio(audioPath);
        audio.play().then(() => { audio.onended = finalizarTurno; }).catch(() => { hablarRobot(t, finalizarTurno); });
    }

    function hablarRobot(texto, onEndCb) {
        window.speechSynthesis.cancel();
        const m = new SpeechSynthesisUtterance(texto);
        m.lang = 'es-ES'; m.rate = 0.85;
        m.onend = onEndCb;
        window.speechSynthesis.speak(m);
    }
</script>
</body>
</html>
